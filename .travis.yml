sudo: false

language: php

branches:
  only: 
    - master

php:
  - 5.5
  - 5.6
  - 7.0

addons:
  postgresql: "9.3"

services:
  - mysql
  - postgresql

cache:
  directories:
    - $HOME/.composer/cache/files
    - $HOME/travis_phantomjs

matrix:
     exclude:
     - php: 5.6
       env: APPLICATION="application/crm-enterprise" TESTSUITE="functional" DB=mysql PARALLEL_PROCESSES=4
     - php: 5.6
       env: APPLICATION="application/platform" TESTSUITE="functional" DB=mysql PARALLEL_PROCESSES=4
     - php: 5.6
       env: APPLICATION="application/crm" TESTSUITE="functional" DB=mysql PARALLEL_PROCESSES=4
     - php: 5.6
       env: APPLICATION="application/commerce" TESTSUITE="functional" DB=mysql DB_NAME=oro_commerce PARALLEL_PROCESSES=4
     - php: 5.6
       env: APPLICATION="application/commerce-enterprise" TESTSUITE="functional" DB=mysql DB_NAME=oro_commerce PARALLEL_PROCESSES=4
     - php: 7.0
       env: APPLICATION="application/crm-enterprise" TESTSUITE="functional" DB=mysql PARALLEL_PROCESSES=4
     - php: 7.0
       env: APPLICATION="application/platform" TESTSUITE="functional" DB=mysql PARALLEL_PROCESSES=4
     - php: 7.0
       env: APPLICATION="application/crm" TESTSUITE="functional" DB=mysql PARALLEL_PROCESSES=4
     - php: 7.0
       env: APPLICATION="application/commerce" TESTSUITE="functional" DB=mysql DB_NAME=oro_commerce PARALLEL_PROCESSES=4
     - php: 7.0
       env: APPLICATION="application/commerce-enterprise" TESTSUITE="functional" DB=mysql DB_NAME=oro_commerce PARALLEL_PROCESSES=4
     include:
     - php: 7.0
       env: APPLICATION="package" CS="YES"
     - language: python
       python: 2.6
       env: APPLICATION="documentation"
     - language: python
       python: 2.7
       env: APPLICATION="documentation"
     - php: 5.5
       env: APPLICATION="application/commerce" TESTSUITE="functional" DB=postgresql DB_NAME=oro_commerce UPDATE_FROM=commerce_beta1 PARALLEL_PROCESSES=4
     - php: 5.5
       env: APPLICATION="application/commerce-enterprise" TESTSUITE="functional" DB=postgresql DB_NAME=oro_commerce PARALLEL_PROCESSES=4 WITH_ASSETS=true
     - php: 5.6
       env: APPLICATION="application/crm-enterprise" TESTSUITE="functional" DB=postgresql PARALLEL_PROCESSES=4
     - php: 7.0
       env: APPLICATION="application/platform" TESTSUITE="unit"
     - php: 7.0
       env: APPLICATION="application/crm" TESTSUITE="unit"
     - php: 7.0
       env: APPLICATION="application/commerce" TESTSUITE="unit"
     - php: 7.0
       env: APPLICATION="application/crm-enterprise" TESTSUITE="functional" DB=mysql PARALLEL_PROCESSES=6
     - php: 7.0
       env: APPLICATION="application/crm-enterprise" TESTSUITE="functional" DB=postgresql PARALLEL_PROCESSES=6
     - php: 7.0
       env: APPLICATION="application/commerce" TESTSUITE="functional" DB=postgresql DB_NAME=oro_commerce PARALLEL_PROCESSES=7
     - php: 7.0
       env: APPLICATION="application/commerce" TESTSUITE="functional" DB=mysql DB_NAME=oro_commerce UPDATE_FROM=commerce_beta1 PARALLEL_PROCESSES=7
     - php: 7.0
       env: APPLICATION="application/commerce" TESTSUITE="functional" DB=postgresql DB_NAME=oro_commerce UPDATE_FROM=commerce_beta2 PARALLEL_PROCESSES=7
     - php: 7.0
       env: APPLICATION="application/commerce" TESTSUITE="functional" DB=mysql DB_NAME=oro_commerce UPDATE_FROM=commerce_beta3 PARALLEL_PROCESSES=7
     - language: node_js
       node_js: 4
       env: APPLICATION="package" JS="YES"
     - php: 7.0
       env: APPLICATION="application/crm-enterprise" TESTSUITE="functional" DB=postgresql PARALLEL_PROCESSES=6 WITH_ASSETS=true
     - php: 7.0
       env: APPLICATION="application/crm-enterprise" TESTSUITE="functional" DB=postgresql SOAP=true SEGFAULT=true
     - php: 7.0
       env: APPLICATION="application/crm-enterprise" TESTSUITE="behat" DB=mysql WITH_ASSETS=true
     - php: 7.0
       env: APPLICATION="application/commerce" TESTSUITE="behat" DB=mysql WITH_ASSETS=true

env:
  global:
     - secure: "gmQOqXchZLf9vPDRKUCGcIQB1HsxlHHWdCTqY1e1OJs9yXyqg1aRodgkCB2P86w/PVqDBnwR0xKaavKrL386SGJ7XvJcZ5ZZPWAozRJFwYBNr2oGv+Ib21sp7+dM01rZxQsPTGyoVeNrldXw5f7uX6IzrGGEmwfGECKqidpFT2zqCgX7cSC9Vnm+GtnWoyAykUIGusO62JgWoiwWYswIZ5iZkHFujZuyfzRIl+DRmke62n2fAFNv1i1k57N8VpRmB+XaJflh798tEtlpvJlW8o1LeGzG6k6Wdx0eCtVxEWt3HqqzQX8FrrOgNvI7Jgp3EaL2Wrwez9xE1084AC+Gj0oZbvsiDzYuZ1ZasFETeA2fHDO3ek6jCkMJQZHMu3JdOP0BmPPddQMgL7er/5XzfHedel/GW5JBki0FBNeVGkib0QdpipgAvt+C6Sh8UyLawjhL6nK4aA5ntKFmBtwA404iXAEJbPn8m1dzia5oCmWz8xSw/z5rnjh9UTZ1vgSk4/a4wdtIUqNC5FbJP/UHGnawLzciLuhDUGo3n+YQ7+LjzaTNrbPAHUKn2/4mb65CiTuBzmhyHMDbdEnShHbpDZ7iRzN7EWXbxIyAleBmCaAEN2JG7Cq4kWBaf5Dwf4cHdkIDdqXE+rb8WjekBGDSMyHbbeLnNcxk4P2eBZSWbyM="
  matrix:
     - APPLICATION="application/platform" TESTSUITE="functional" DB=mysql PARALLEL_PROCESSES=4
     - APPLICATION="application/crm" TESTSUITE="functional" DB=mysql PARALLEL_PROCESSES=4
     - APPLICATION="application/crm-enterprise" TESTSUITE="functional" DB=mysql PARALLEL_PROCESSES=4
     - APPLICATION="application/crm-enterprise" TESTSUITE="unit"
     - APPLICATION="application/commerce" TESTSUITE="functional" DB=mysql DB_NAME=oro_commerce PARALLEL_PROCESSES=4
     - APPLICATION="application/commerce-enterprise" TESTSUITE="functional" DB=mysql DB_NAME=oro_commerce PARALLEL_PROCESSES=4
     - APPLICATION="application/commerce-enterprise" TESTSUITE="unit"

before_install: . ./.travis.sh before_install

install: if [ -z "$TRAVIS_SKIP" ]; then ./.travis.sh install; fi

before_script: if [ -z "$TRAVIS_SKIP" ]; then ./.travis.sh before_script; fi

script: if [ -z "$TRAVIS_SKIP" ]; then ./.travis.sh script; fi
