datagrid:
    # Newsletter subscribers filtering is added by CustomerDataGridListener
    magento-customers-grid:
        extended_entity_name: OroCRM\Bundle\MagentoBundle\Entity\Customer
        acl_resource: orocrm_magento_customer_view
        source:
            type: orm
            query:
                select:
                    - c.id
                    - c.firstName
                    - c.lastName
                    - c.email
                    - CASE WHEN c.lifetime IS NOT NULL THEN c.lifetime ELSE 0 END as lifetime
                    - c.currency
                    - c.createdAt
                    - c.updatedAt
                    - dataChannel.name as channelName
                    - channel.id as OroCRM\Bundle\MagentoBundle\Datagrid\AbstractTwoWaySyncActionPermissionProvider::CHANNEL_KEY
                    - country.name as countryName
                    - CONCAT(CASE WHEN address.regionText IS NOT NULL THEN address.regionText ELSE region.name END, '') as regionName
                    - cw.name as websiteName
                    - c.originId as OroCRM\Bundle\MagentoBundle\Datagrid\AbstractTwoWaySyncActionPermissionProvider::CUSTOMER_ORIGIN_ID
                    - c.id as OroCRM\Bundle\MagentoBundle\Datagrid\AbstractTwoWaySyncActionPermissionProvider::CUSTOMER_ID
                    - c.guest
                from:
                    - { table: OroCRM\Bundle\MagentoBundle\Entity\Customer , alias: c }
                join:
                    left:
                        - { join: c.dataChannel, alias: dataChannel }
                        - { join: c.channel, alias: channel }
                        - { join: c.addresses, alias: address,  conditionType: WITH, condition: "address.primary = true"}
                        - { join: address.country, alias: country }
                        - { join: address.region, alias: region }
                        - { join: c.website, alias: cw }
        columns:
            channelName:
                label:            orocrm.magento.customer.data_channel.label
            websiteName:
                label:            orocrm.magento.customer.website.label
            firstName:
                label:            orocrm.magento.customer.first_name.label
            lastName:
                label:            orocrm.magento.customer.last_name.label
            email:
                label:            orocrm.magento.customer.email.label
            lifetime:
                label:            orocrm.magento.customer.lifetime.label
                type:             localized_number
                method:           formatCurrency
                context_resolver: OroCRM\Bundle\MagentoBundle\Grid\FormatterContextResolver::getResolverCurrencyClosure
                align:            right
            countryName:
                label:            orocrm.magento.datagrid.columns.billing_country
            regionName:
                label:            orocrm.magento.datagrid.columns.billing_region
            createdAt:
                label:            oro.ui.created_at
                frontend_type:    datetime
            updatedAt:
                label:            oro.ui.updated_at
                frontend_type:    datetime
        properties:
            id: ~
            view_link:
                type: url
                route: orocrm_magento_customer_view
                params: [ id ]
            update_link:
                type: url
                route: orocrm_magento_customer_update
                params: [ id ]
            subscribe_link:
                type: url
                route: orocrm_magento_newsletter_subscriber_subscribe_customer
                params: [ id ]
            unsubscribe_link:
                type: url
                route: orocrm_magento_newsletter_subscriber_unsubscribe_customer
                params: [ id ]
        sorters:
            columns:
                firstName:   { data_name: c.firstName }
                lastName:    { data_name: c.lastName }
                email:       { data_name: c.email }
                channelName: { data_name: channelName }
                websiteName: { data_name: cw.name }
                createdAt:   { data_name: c.createdAt }
                updatedAt:   { data_name: c.updatedAt }
                countryName: { data_name: country.name }
                lifetime:    { data_name: c.lifetime }
                regionName:  { data_name: address.regionName }
            default:
                lastName:  ASC
                firstName: ASC
        filters:
            columns:
                channelName:
                    type:      entity
                    data_name: dataChannel.id
                    options:
                        field_options:
                            class: OroCRMChannelBundle:Channel
                            property: name
                            translatable_options: false
                websiteName:
                    type: entity
                    data_name: cw.id
                    options:
                        field_options:
                            class: OroCRMMagentoBundle:Website
                            property: name
                            translatable_options: false
                    enabled: false
                firstName:
                    type: string
                    data_name: c.firstName
                lastName:
                    type: string
                    data_name: c.lastName
                email:
                    type: string
                    data_name: c.email
                countryName:
                    type: entity
                    data_name: address.country
                    options:
                        field_options:
                            class: OroAddressBundle:Country
                            property: name
                            query_builder:  "@orocrm_magento.country.datagrid_helper->getCountryFilterQueryBuilder"
                            translatable_options: false
                regionName:
                    type: string
                    data_name: regionName
                lifetime:
                    type: number-range
                    data_name: c.lifetime
                guest:
                    label: orocrm.magento.datagrid.columns.customer_is_guest.label
                    type: boolean
                    data_name: c.guest
                createdAt:
                    type:      datetime
                    data_name: c.createdAt
                    enabled: false
                updatedAt:
                    type:      datetime
                    data_name: c.updatedAt
                    enabled: false
        actions:
            view:
                type:         navigate
                label:        oro.grid.action.view
                link:         view_link
                icon:         eye-open
                acl_resource: orocrm_magento_customer_view
                rowAction:    true
            update:
                type:         navigate
                acl_resource: orocrm_magento_customer_update
                label:        oro.grid.action.update
                icon:         edit
                link:         update_link
            subscribe:
                type: ajaxdelete
                label: orocrm.magento.newslettersubscriber.action.subscribe
                link:  subscribe_link
                icon: plus
                acl_resource: orocrm_magento_newsletter_subscriber_subscribe
                defaultMessages:
                    confirm_title:   orocrm.magento.newslettersubscriber.action.confirm_title.subscribe
                    confirm_ok:      orocrm.magento.newslettersubscriber.action.confirm_ok
                    confirm_cancel:  orocrm.magento.newslettersubscriber.action.confirm_cancel
                    confirm_content: orocrm.magento.newslettersubscriber.action.content.subscribe
                    success:         orocrm.magento.newslettersubscriber.action.success.subscribe
                    error:           orocrm.magento.newslettersubscriber.action.error.subscribe
            unsubscribe:
                type: ajaxdelete
                label: orocrm.magento.newslettersubscriber.action.unsubscribe
                link: unsubscribe_link
                icon: minus
                acl_resource: orocrm_magento_newsletter_subscriber_unsubscribe
                defaultMessages:
                    confirm_title:   orocrm.magento.newslettersubscriber.action.confirm_title.unsubscribe
                    confirm_ok:      orocrm.magento.newslettersubscriber.action.confirm_ok
                    confirm_cancel:  orocrm.magento.newslettersubscriber.action.confirm_cancel
                    confirm_content: orocrm.magento.newslettersubscriber.action.content.unsubscribe
                    success:         orocrm.magento.newslettersubscriber.action.success.unsubscribe
                    error:           orocrm.magento.newslettersubscriber.action.error.unsubscribe

        action_configuration: [ "@orocrm_magento.datagrid.customer_actions_provider", "getCustomerActionsPermissions"]
        options:
            entityHint: customer
            export: true
            entity_pagination: true

    magento-cart-grid:
        extended_entity_name: OroCRM\Bundle\MagentoBundle\Entity\Cart
        acl_resource: orocrm_magento_cart_view
        source:
            type: orm
            query:
                select:
                    - c.id
                    - c.originId
                    - c.email
                    - c.firstName
                    - c.lastName
                    - c.itemsQty
                    - c.quoteCurrencyCode as currency
                    - c.grandTotal
                    - c.createdAt
                    - c.updatedAt
                    - cstatus.label as statusLabel
                    - channel.name as channelName
                    - country.name as countryName
                    - CONCAT(CASE WHEN address.regionText IS NOT NULL THEN address.regionText ELSE region.name END, '') as regionName
                    - cw.name as websiteName
                from:
                    - { table: OroCRM\Bundle\MagentoBundle\Entity\Cart , alias: c }
                join:
                    left:
                        - { join: c.store, alias: cs }
                        - { join: c.dataChannel, alias: channel }
                        - { join: c.status, alias: cstatus }
                        - { join: c.billingAddress, alias: address }
                        - { join: address.country, alias: country }
                        - { join: address.region, alias: region }
                        - { join: cs.website, alias: cw }
        columns:
            channelName:
                label:            orocrm.magento.cart.data_channel.label
            websiteName:
                label:            orocrm.magento.cart.website.label
            originId:
                label:            orocrm.magento.cart.id.label
            firstName:
                label:            orocrm.magento.datagrid.columns.first_name
            lastName:
                label:            orocrm.magento.datagrid.columns.last_name
            email:
                label:            orocrm.magento.cart.email.label
            itemsQty:
                label:            orocrm.magento.datagrid.columns.qty
                frontend_type:    integer
            grandTotal:
                label:            orocrm.magento.cart.grand_total.label
                type:             localized_number
                method:           formatCurrency
                context_resolver: OroCRM\Bundle\MagentoBundle\Grid\FormatterContextResolver::getResolverCurrencyClosure
                align:            right
            createdAt:
                label:            oro.ui.created_at
                frontend_type:    datetime
            updatedAt:
                label:            oro.ui.updated_at
                frontend_type:    datetime
            countryName:
                label:            orocrm.magento.datagrid.columns.billing_country
            regionName:
                label:            orocrm.magento.datagrid.columns.billing_region
            statusLabel:
                label:            orocrm.magento.datagrid.columns.status
        properties:
            id: ~
            view_link:
                type: url
                route: orocrm_magento_cart_view
                params: [ id ]
        sorters:
            columns:
                originId:    { data_name: c.originId }
                firstName:   { data_name: c.firstName }
                lastName:    { data_name: c.lastName }
                email:       { data_name: c.email }
                itemsQty:    { data_name: c.itemsQty }
                channelName: { data_name: channelName }
                websiteName: { data_name: cw.name }
                grandTotal:  { data_name: c.grandTotal }
                createdAt:   { data_name: c.createdAt }
                updatedAt:   { data_name: c.updatedAt }
                countryName: { data_name: country.name }
                regionName:  { data_name: regionName }
                statusLabel: { data_name: cstatus.label }
            default:
                updatedAt:  DESC
        filters:
            columns:
                channelName:
                    type:      entity
                    data_name: channel.id
                    options:
                        field_options:
                            class: OroCRMChannelBundle:Channel
                            property: name
                            translatable_options: false
                websiteName:
                    type: entity
                    data_name: cw.id
                    options:
                        field_options:
                            class: OroCRMMagentoBundle:Website
                            property: name
                    enabled:   false
                originId:
                    type: number-range
                    data_name: c.originId
                firstName:
                    type: string
                    data_name: c.firstName
                lastName:
                    type: string
                    data_name: c.lastName
                email:
                    type: string
                    data_name: c.email
                grandTotal:
                    type: currency
                    data_name: c.grandTotal
                countryName:
                    type: entity
                    data_name: address.country
                    enabled:          false
                    options:
                        field_options:
                            class: OroAddressBundle:Country
                            property: name
                            query_builder:  "@orocrm_magento.country.datagrid_helper->getCountryFilterQueryBuilder"
                            translatable_options: false
                regionName:
                    type:      string
                    data_name: regionName
                    enabled:   false
                statusLabel:
                    type: entity
                    data_name: c.status
                    options:
                        field_options:
                            class: OroCRMMagentoBundle:CartStatus
                            property: label
                            translatable_options: false
                createdAt:
                    type:      datetime
                    data_name: c.createdAt
                    enabled: false
                updatedAt:
                    type:      datetime
                    data_name: c.updatedAt
                    enabled: false
        actions:
            view:
                type:         navigate
                label:        oro.grid.action.view
                link:         view_link
                icon:         eye-open
                acl_resource: orocrm_magento_cart_view
                rowAction:    true
        options:
            entityHint: cart
            export: true
            entity_pagination: true

    magento-cartitem-grid:
        extended_entity_name: OroCRM\Bundle\MagentoBundle\Entity\CartItem
        acl_resource: orocrm_magento_cart_view
        source:
            type: orm
            query:
                select:
                    - c.id
                    - c.sku
                    - c.name
                    - c.qty
                    - c.giftMessage
                    - c.price
                    - c.priceInclTax
                    - c.rowTotal
                    - c.taxAmount
                    - c.discountAmount
                    - c.weight
                    - c.productType
                    - c.createdAt
                    - c.updatedAt
                    - co.quoteCurrencyCode as currency
                from:
                    - { table: OroCRM\Bundle\MagentoBundle\Entity\CartItem , alias: c }
                join:
                    left:
                        - { join: c.cart, alias: co }
                where:
                    and:
                        - c.cart = :id
            bind_parameters:
                - id
        properties:
            id: ~
        sorters:
            columns:
                sku:            { data_name: c.sku }
                name:           { data_name: c.name }
                giftMessage:    { data_name: c.giftMessage }
                price:          { data_name: c.price }
                priceInclTax:   { data_name: c.priceInclTax }
                rowTotal:       { data_name: c.rowTotal }
                taxAmount:      { data_name: c.taxAmount }
                discountAmount: { data_name: c.discountAmount }
                weight:         { data_name: c.weight }
                createdAt:      { data_name: c.createdAt }
                updatedAt:      { data_name: c.updatedAt }
            default:
                createdAt:  DESC
        options:
            entityHint: cart item
            toolbarOptions:
                hide: true
                pagination:
                    hide: true

    magento-cartitem-active-grid:
        extends: magento-cartitem-grid
        source:
            query:
                where:
                    and:
                        - c.removed = false
        columns:
            sku:
                label:            orocrm.magento.datagrid.columns.sku
            name:
                label:            orocrm.magento.datagrid.columns.name
            qty:
                label:            orocrm.magento.datagrid.columns.qty
                frontend_type:    integer
            giftMessage:
                label:            orocrm.magento.datagrid.columns.gift_message
            price:
                label:            orocrm.magento.datagrid.columns.price
                type:             localized_number
                method:           formatCurrency
                context_resolver: OroCRM\Bundle\MagentoBundle\Grid\FormatterContextResolver::getResolverCurrencyClosure
                align:            right
            priceInclTax:
                label:            orocrm.magento.datagrid.columns.price_incl_tax
                type:             localized_number
                method:           formatCurrency
                context_resolver: OroCRM\Bundle\MagentoBundle\Grid\FormatterContextResolver::getResolverCurrencyClosure
                align:            right
            rowTotal:
                label:            orocrm.magento.datagrid.columns.row_total
                type:             localized_number
                method:           formatCurrency
                context_resolver: OroCRM\Bundle\MagentoBundle\Grid\FormatterContextResolver::getResolverCurrencyClosure
                align:            right
            taxAmount:
                label:            orocrm.magento.datagrid.columns.tax_amount
                type:             localized_number
                method:           formatCurrency
                context_resolver: OroCRM\Bundle\MagentoBundle\Grid\FormatterContextResolver::getResolverCurrencyClosure
                align:            right
            discountAmount:
                label:            orocrm.magento.datagrid.columns.discount_amount
                type:             localized_number
                method:           formatCurrency
                context_resolver: OroCRM\Bundle\MagentoBundle\Grid\FormatterContextResolver::getResolverCurrencyClosure
                align:            right
            weight:
                label:            orocrm.magento.datagrid.columns.weight
                frontend_type:    decimal
            createdAt:
                label:            orocrm.magento.datagrid.columns.added_on
                frontend_type:    datetime
            updatedAt:
                label:            oro.ui.updated_at
                frontend_type:    datetime
        sorters:
            columns:
                qty:            { data_name: c.qty }

    magento-cartitem-removed-grid:
        extends: magento-cartitem-grid
        source:
            query:
                where:
                    and:
                        - c.removed = true
        columns:
            sku:
                label:            orocrm.magento.datagrid.columns.sku
            name:
                label:            orocrm.magento.datagrid.columns.name
            giftMessage:
                label:            orocrm.magento.datagrid.columns.gift_message
            price:
                label:            orocrm.magento.datagrid.columns.price
                type:             localized_number
                method:           formatCurrency
                context_resolver: OroCRM\Bundle\MagentoBundle\Grid\FormatterContextResolver::getResolverCurrencyClosure
                align:            right
            priceInclTax:
                label:            orocrm.magento.datagrid.columns.price_incl_tax
                type:             localized_number
                method:           formatCurrency
                context_resolver: OroCRM\Bundle\MagentoBundle\Grid\FormatterContextResolver::getResolverCurrencyClosure
                align:            right
            rowTotal:
                label:            orocrm.magento.datagrid.columns.row_total
                type:             localized_number
                method:           formatCurrency
                context_resolver: OroCRM\Bundle\MagentoBundle\Grid\FormatterContextResolver::getResolverCurrencyClosure
                align:            right
            taxAmount:
                label:            orocrm.magento.datagrid.columns.tax_amount
                type:             localized_number
                method:           formatCurrency
                context_resolver: OroCRM\Bundle\MagentoBundle\Grid\FormatterContextResolver::getResolverCurrencyClosure
                align:            right
            discountAmount:
                label:            orocrm.magento.datagrid.columns.discount_amount
                type:             localized_number
                method:           formatCurrency
                context_resolver: OroCRM\Bundle\MagentoBundle\Grid\FormatterContextResolver::getResolverCurrencyClosure
                align:            right
            weight:
                label:            orocrm.magento.datagrid.columns.weight
                frontend_type:    decimal
            createdAt:
                label:            orocrm.magento.datagrid.columns.added_on
                frontend_type:    datetime
            updatedAt:
                label:            orocrm.magento.datagrid.columns.removed_at
                frontend_type:    datetime

    magento-products-grid:
        extended_entity_name: OroCRM\Bundle\MagentoBundle\Entity\Product
        acl_resource: orocrm_magento_product_view
        source:
            type: orm
            query:
                select:
                    - p
                from:
                    - { table: OroCRM\Bundle\MagentoBundle\Entity\Product , alias: p }
                join:
                    left:
                        - { join: p.channel, alias: pch }
                        - { join: p.websites, alias: pw }
        columns:
            name:
                label:         orocrm.magento.datagrid.columns.name
            sku:
                label:         orocrm.magento.datagrid.columns.sku
            type:
                label:         orocrm.magento.datagrid.columns.type
            price:
                label:         orocrm.magento.datagrid.columns.price
                frontend_type: decimal
            specialPrice:
                label:         orocrm.magento.datagrid.columns.specialPrice
                frontend_type: decimal
            websites:
                label:         orocrm.magento.datagrid.columns.websites
                type:          callback
                callable:      OroCRM\Bundle\MagentoBundle\Converter\WebsiteCollectionToString::getConverterCallback
            createdAt:
                label:         oro.ui.created_at
                frontend_type: datetime
            updatedAt:
                label:         oro.ui.updated_at
                frontend_type: datetime
        properties:
            id: ~
            view_link:
                type: url
                route: orocrm_magento_product_view
                params: [ id ]
        sorters:
            columns:
                name:          { data_name: p.name }
                sku:           { data_name: p.sku }
                type:          { data_name: p.type }
                price:         { data_name: p.price }
                specialPrice:  { data_name: p.specialPrice }
                createdAt:     { data_name: p.createdAt }
                updatedAt:     { data_name: p.updatedAt }
        filters:
            columns:
                name:
                    type: string
                    data_name: p.name
                sku:
                    type: string
                    data_name: p.sku
                type:
                    type: string
                    data_name: p.type
                price:
                    type:             currency
                    data_name:        p.price
                    options:
                        data_type:    Oro\Bundle\FilterBundle\Form\Type\Filter\NumberFilterType::DATA_DECIMAL
                specialPrice:
                    type:             currency
                    data_name:        p.specialPrice
                    options:
                        data_type:    Oro\Bundle\FilterBundle\Form\Type\Filter\NumberFilterType::DATA_DECIMAL
                websites:
                    type: entity
                    data_name: pw.id
                    options:
                        field_options:
                            class: OroCRMMagentoBundle:Website
                            multiple: true
                            property: name
                            translatable_options: false
                createdAt:
                    type:      datetime
                    data_name: c.createdAt
                    enabled: false
                updatedAt:
                    type:      datetime
                    data_name: c.updatedAt
                    enabled: false
        actions:
            view:
                type:         navigate
                label:        oro.grid.action.view
                link:         view_link
                icon:         eye-open
                acl_resource: orocrm_magento_product_view
                rowAction:    true
        options:
            entityHint: magento product

    magento-order-grid:
        extended_entity_name: OroCRM\Bundle\MagentoBundle\Entity\Order
        acl_resource: orocrm_magento_order_view
        source:
            type: orm
            query:
                select:
                    - o.id
                    - o.currency
                    - o.incrementId
                    - o.createdAt
                    - o.updatedAt
                    - o.totalPaidAmount
                    - o.status
                    - o.firstName
                    - o.lastName
                    - o.subtotalAmount as subTotal
                    - o.totalAmount as grandTotal
                    - o.customerEmail as email
                    - channel.name as channelName
                    - cw.name as websiteName
                    - o.discountAmount
                    - o.discountPercent
                    - o.couponCode
                    - >
                        (SELECT country.name FROM OroCRMMagentoBundle:OrderAddress address_c
                        LEFT JOIN address_c.country country
                        LEFT JOIN address_c.types types_c
                        WHERE address_c.owner = o AND (types_c.name = 'billing' OR types_c.name IS NULL)) as countryName
                    - >
                        (SELECT CONCAT(CASE WHEN address_r.regionText IS NOT NULL THEN address_r.regionText ELSE region.name END, '')
                        FROM OroCRMMagentoBundle:OrderAddress address_r
                        LEFT JOIN address_r.region region
                        LEFT JOIN address_r.types types_r
                        WHERE address_r.owner = o AND (types_r.name = 'billing' OR types_r.name IS NULL)) as regionName
                from:
                    - { table: OroCRM\Bundle\MagentoBundle\Entity\Order, alias: o }
                join:
                    left:
                        - { join: o.customer, alias: customer }
                        - { join: o.dataChannel, alias: channel }
                        - { join: o.store, alias: cs }
                        - { join: cs.website, alias: cw }
        columns:
            channelName:
                label:            orocrm.magento.order.data_channel.label
            websiteName:
                label:            orocrm.magento.order.website.label
            incrementId:
                label:            orocrm.magento.order.increment_id.label
            firstName:
                label:            orocrm.magento.datagrid.columns.first_name
            lastName:
                label:            orocrm.magento.datagrid.columns.last_name
            email:
                label:            orocrm.magento.datagrid.columns.email
            createdAt:
                label:            oro.ui.created_at
                frontend_type:    datetime
            updatedAt:
                label:            oro.ui.updated_at
                frontend_type:    datetime
            totalPaidAmount:
                label:            orocrm.magento.order.total_paid_amount.label
                type:             localized_number
                method:           formatCurrency
                context_resolver: OroCRM\Bundle\MagentoBundle\Grid\FormatterContextResolver::getResolverCurrencyClosure
                align:            right
            grandTotal:
                label:            orocrm.magento.cart.grand_total.label
                type:             localized_number
                method:           formatCurrency
                context_resolver: OroCRM\Bundle\MagentoBundle\Grid\FormatterContextResolver::getResolverCurrencyClosure
                align:            right
            subTotal:
                label:            orocrm.magento.cart.sub_total.label
                type:             localized_number
                method:           formatCurrency
                context_resolver: OroCRM\Bundle\MagentoBundle\Grid\FormatterContextResolver::getResolverCurrencyClosure
                align:            right
            countryName:
                label:            orocrm.magento.datagrid.columns.billing_country
            regionName:
                label:            orocrm.magento.datagrid.columns.billing_region
            status:
                label:            orocrm.magento.order.status.label
        properties:
            id: ~
            view_link:
                type: url
                route: orocrm_magento_order_view
                params: [ id ]
        sorters:
            columns:
                incrementId:            { data_name: o.incrementId }
                firstName:              { data_name: o.firstName }
                lastName:               { data_name: o.lastName }
                email:                  { data_name: email }
                totalPaidAmount:        { data_name: o.totalPaidAmount }
                grandTotal:             { data_name: grandTotal }
                subTotal:               { data_name: subTotal }
                countryName:            { data_name: countryName }
                regionName:             { data_name: regionName }
                status:                 { data_name: o.status }
                channelName:            { data_name: channelName }
                websiteName:            { data_name: cw.name }
                createdAt:              { data_name: o.createdAt }
                updatedAt:              { data_name: o.updatedAt }
            default:
                createdAt:  DESC
        filters:
            columns:
                channelName:
                    type:      entity
                    data_name: channel.id
                    options:
                        field_options:
                            class: OroCRMChannelBundle:Channel
                            property: name
                            translatable_options: false
                websiteName:
                    type: entity
                    data_name: cw.id
                    options:
                        field_options:
                            class: OroCRMMagentoBundle:Website
                            property: name
                            translatable_options: false
                    enabled:   false
                incrementId:
                    type:             string
                    data_name:        o.incrementId
                firstName:
                    type:             string
                    data_name:        o.firstName
                lastName:
                    type:             string
                    data_name:        o.lastName
                email:
                    type:             string
                    data_name:        email
                createdAt:
                    type:             datetime
                    data_name:        o.createdAt
                    enabled:          false
                updatedAt:
                    type:             datetime
                    data_name:        o.updatedAt
                    enabled:          false
                totalPaidAmount:
                    type:             currency
                    data_name:        o.totalPaidAmount
                    options:
                        data_type:    Oro\Bundle\FilterBundle\Form\Type\Filter\NumberFilterType::DATA_DECIMAL
                grandTotal:
                    type:             currency
                    data_name:        grandTotal
                    options:
                        data_type:    Oro\Bundle\FilterBundle\Form\Type\Filter\NumberFilterType::DATA_DECIMAL
                subTotal:
                    type:             currency
                    data_name:        subTotal
                    options:
                        data_type:    Oro\Bundle\FilterBundle\Form\Type\Filter\NumberFilterType::DATA_DECIMAL
                status:
                    type:             string
                    data_name:        o.status
                guest:
                    label: orocrm.magento.datagrid.columns.order_is_guest.label
                    type: boolean
                    data_name: o.isGuest
                discountAmount:
                    label:            orocrm.magento.datagrid.columns.discount_amount
                    type:             currency
                    data_name:        o.discountAmount
                    enabled:          false
                discountPercent:
                    label:            orocrm.magento.datagrid.columns.discount_percent
                    type:             percent
                    data_name:        o.discountPercent
                    enabled:          false
                couponCode:
                    label:     orocrm.magento.datagrid.columns.coupon_code
                    type:      string
                    data_name: o.couponCode
                    enabled:   false
        actions:
            view:
                type:         navigate
                label:        oro.grid.action.view
                link:         view_link
                icon:         eye-open
                acl_resource: orocrm_magento_order_view
                rowAction:    true
        options:
            entityHint: order
            export: true
            entity_pagination: true

    magento-orderitem-grid:
        extended_entity_name: OroCRM\Bundle\MagentoBundle\Entity\OrderItem
        acl_resource: orocrm_magento_order_view
        source:
            type: orm
            query:
                select:
                    - oi.id
                    - oi.sku
                    - oi.name
                    - oi.qty
                    - oi.productType
                    - oi.weight
                    - oi.price
                    - oi.originalPrice
                    - oi.discountPercent
                    - oi.discountAmount
                    - oi.taxPercent
                    - oi.taxAmount
                    - oi.rowTotal
                    - o.currency
                from:
                    - { table: OroCRM\Bundle\MagentoBundle\Entity\OrderItem , alias: oi }
                join:
                    left:
                        - { join: oi.order, alias: o }
                where:
                    and:
                        - oi.order = :id
            bind_parameters:
                - id
        columns:
            sku:
                label: orocrm.magento.datagrid.columns.sku
            name:
                label: orocrm.magento.datagrid.columns.name
            qty:
                label: orocrm.magento.datagrid.columns.qty
                frontend_type: number
            productType:
                label: orocrm.magento.datagrid.columns.productType
            weight:
                label: orocrm.magento.datagrid.columns.weight
                frontend_type: decimal
            price:
                label: orocrm.magento.datagrid.columns.price
                type:   localized_number
                method: formatCurrency
                context_resolver: OroCRM\Bundle\MagentoBundle\Grid\FormatterContextResolver::getResolverCurrencyClosure
                align: right
            originalPrice:
                label: orocrm.magento.datagrid.columns.originalPrice
                type:   localized_number
                method: formatCurrency
                context_resolver: OroCRM\Bundle\MagentoBundle\Grid\FormatterContextResolver::getResolverCurrencyClosure
                align: right
            discountPercent:
                label: orocrm.magento.datagrid.columns.discountPercent
                frontend_type: percent
            discountAmount:
                label: orocrm.magento.datagrid.columns.discountAmount
                type:   localized_number
                method: formatCurrency
                context_resolver: OroCRM\Bundle\MagentoBundle\Grid\FormatterContextResolver::getResolverCurrencyClosure
                align: right
            taxPercent:
                label: orocrm.magento.datagrid.columns.taxPercent
                frontend_type: percent
            taxAmount:
                label: orocrm.magento.datagrid.columns.taxAmount
                type:   localized_number
                method: formatCurrency
                context_resolver: OroCRM\Bundle\MagentoBundle\Grid\FormatterContextResolver::getResolverCurrencyClosure
                align: right
            rowTotal:
                label: orocrm.magento.datagrid.columns.rowTotal
                type:   localized_number
                method: formatCurrency
                context_resolver: OroCRM\Bundle\MagentoBundle\Grid\FormatterContextResolver::getResolverCurrencyClosure
                align: right
        sorters:
            columns:
                sku:                 { data_name: oi.sku }
                name:                { data_name: oi.name }
                qty:                 { data_name: oi.qty }
                productType:         { data_name: oi.productType }
                weight:              { data_name: oi.weight }
                price:               { data_name: oi.price }
                originalPrice:       { data_name: oi.originalPrice }
                discountPercent:     { data_name: oi.discountPercent }
                discountAmount:      { data_name: oi.discountAmount }
                taxPercent:          { data_name: oi.taxPercent }
                taxAmount:           { data_name: oi.taxAmount }
                rowTotal:            { data_name: oi.rowTotal }
        options:
            entityHint: order item
            toolbarOptions:
                hide: true
                pagination:
                    hide: true

    #FIXME: check group by
    magento-customer-order-grid:
        acl_resource: orocrm_magento_order_view
        source:
            type: orm
            query:
                select:
                    - o.id
                    - o.incrementId
                    - o.totalAmount
                    - o.totalPaidAmount
                    - o.status
                    - o.currency
                    - COUNT(items.id) as itemsCount
                from:
                    - { table: %orocrm_magento.order.entity.class%, alias: o }
                join:
                    left:
                        - { join: o.items, alias: items }
                where:
                    and:
                        - o.customer = :customerId AND o.channel = :channelId
                groupBy: o.id
        columns:
            incrementId:
                label: orocrm.magento.order.id.label
            itemsCount:
                label: orocrm.magento.order.items_qty.label
                frontend_type: integer
            totalAmount:
                label: orocrm.magento.order.total_amount.label
                type:   localized_number
                method: formatCurrency
                context_resolver: OroCRM\Bundle\MagentoBundle\Grid\FormatterContextResolver::getResolverCurrencyClosure
                align: right
            totalPaidAmount:
                label:  orocrm.magento.order.total_paid_amount.label
                type:   localized_number
                method: formatCurrency
                context_resolver: OroCRM\Bundle\MagentoBundle\Grid\FormatterContextResolver::getResolverCurrencyClosure
                align: right
            status:
                label: orocrm.magento.order.status.label
        sorters:
            columns:
                incrementId:     { data_name: o.incrementId }
                itemsCount:      { data_name: itemsCount }
                totalPaidAmount: { data_name: o.totalPaidAmount }
                totalAmount:     { data_name: o.totalAmount }
                status:          { data_name: o.status }
        properties:
            id: ~
            view_link:
                type: url
                route: orocrm_magento_order_view
                params: [ id ]
        actions:
            view:
                type:         navigate
                label:        oro.grid.action.view
                link:         view_link
                icon:         eye-open
                acl_resource: orocrm_magento_order_view
                rowAction:    true

    #FIXME: check group by
    magento-customer-cart-grid:
        acl_resource: orocrm_magento_cart_view
        source:
            type: orm
            query:
                select:
                    - c.id
                    - c.originId
                    - c.grandTotal
                    - c.createdAt
                    - c.updatedAt
                    - c.quoteCurrencyCode as currency
                    - MAX(cstatus.label) as statusLabel
                    - c.itemsCount
                from:
                    - { table: %orocrm_magento.cart.entity.class% , alias: c }
                join:
                    left:
                        - { join: c.status, alias: cstatus }
                where:
                    and:
                        - c.customer = :customerId AND c.channel = :channelId
                groupBy: c.id
        columns:
            originId:
                label:            orocrm.magento.cart.id.label
            itemsCount:
                label:            orocrm.magento.cart.items_count.label
                frontend_type:    integer
            grandTotal:
                label:            orocrm.magento.cart.grand_total.label
                type:             localized_number
                method:           formatCurrency
                context_resolver: OroCRM\Bundle\MagentoBundle\Grid\FormatterContextResolver::getResolverCurrencyClosure
                align:            right
            subTotal:
                label:            orocrm.magento.cart.sub_total.label
                type:             localized_number
                method:           formatCurrency
                context_resolver: OroCRM\Bundle\MagentoBundle\Grid\FormatterContextResolver::getResolverCurrencyClosure
                align:            right
            createdAt:
                label:            oro.ui.created_at
                frontend_type:    datetime
            updatedAt:
                label:            oro.ui.updated_at
                frontend_type:    datetime
            statusLabel:
                label:            orocrm.magento.datagrid.columns.status
        properties:
            id: ~
            view_link:
                type: url
                route: orocrm_magento_cart_view
                params: [ id ]
        sorters:
            columns:
                originId:             { data_name: c.originId }
                itemsCount:           { data_name: c.itemsCount }
                grandTotal:           { data_name: c.grandTotal }
                subTotal:             { data_name: c.subTotal }
                createdAt:            { data_name: c.createdAt }
                updatedAt:            { data_name: c.updatedAt }
                statusLabel:          { data_name: cstatus.label }
            default:
                updatedAt:  DESC
        actions:
            view:
                type:         navigate
                label:        oro.grid.action.view
                link:         view_link
                icon:         eye-open
                acl_resource: orocrm_magento_cart_view
                rowAction:    true

    #FIXME: check group by
    magento-customer-orders-widget-grid:
        acl_resource: orocrm_magento_order_view
        source:
            type: orm
            query:
                select:
                    - o.id
                    - o.incrementId
                    - o.createdAt
                    - o.updatedAt
                    - o.subtotalAmount
                    - o.totalAmount
                    - o.totalPaidAmount
                    - o.status
                    - o.currency
                    - COUNT(items.id) as itemsCount
                    - o.discountAmount
                    - o.discountPercent
                    - o.couponCode
                from:
                    - { table: %orocrm_magento.order.entity.class%, alias: o }
                join:
                    left:
                        - { join: o.items, alias: items }
                where:
                    and:
                        - o.customer = :customerId AND o.channel = :channelId
                groupBy: o.id
        columns:
            incrementId:
                label:            orocrm.magento.order.increment_id.label
            itemsCount:
                label:            orocrm.magento.order.items_qty.label
                frontend_type:    integer
            createdAt:
                label:            oro.ui.created_at
                frontend_type:    datetime
            updatedAt:
                label:            oro.ui.updated_at
                frontend_type:    datetime
            subtotalAmount:
                label:            orocrm.magento.cart.sub_total_amount.label
                type:             localized_number
                method:           formatCurrency
                context_resolver: OroCRM\Bundle\MagentoBundle\Grid\FormatterContextResolver::getResolverCurrencyClosure
                align:            right
            totalAmount:
                label:            orocrm.magento.order.total_amount.label
                type:             localized_number
                method:           formatCurrency
                context_resolver: OroCRM\Bundle\MagentoBundle\Grid\FormatterContextResolver::getResolverCurrencyClosure
                align:            right
            totalPaidAmount:
                label:            orocrm.magento.order.total_paid_amount.label
                type:             localized_number
                method:           formatCurrency
                context_resolver: OroCRM\Bundle\MagentoBundle\Grid\FormatterContextResolver::getResolverCurrencyClosure
                align:            right
            status:
                label:            orocrm.magento.order.status.label
        filters:
            columns:
                incrementId:
                    type:        string
                    data_name:   o.incrementId
                itemsCount:
                    type:        number-range
                    data_name:   itemsCount
                    filter_by_having: true
                createdAt:
                    type:         datetime
                    data_name:    o.createdAt
                updatedAt:
                    type:         datetime
                    data_name:    o.updatedAt
                subtotalAmount:
                    type:         currency
                    data_name:    o.subtotalAmount
                    options:
                       data_type: Oro\Bundle\FilterBundle\Form\Type\Filter\NumberFilterType::DATA_DECIMAL
                totalAmount:
                    type:         currency
                    data_name:    o.totalAmount
                totalPaidAmount:
                    type:         currency
                    data_name:    o.totalPaidAmount
                status:
                    type:         string
                    data_name:    o.status
                discountAmount:
                    label:            orocrm.magento.datagrid.columns.discount_amount
                    type:             currency
                    data_name:        o.discountAmount
                    enabled:          false
                discountPercent:
                    label:            orocrm.magento.datagrid.columns.discount_percent
                    type:             percent
                    data_name:        o.discountPercent
                    enabled:          false
                couponCode:
                    label:     orocrm.magento.datagrid.columns.coupon_code
                    type:      string
                    data_name: o.couponCode
                    enabled:   false
        sorters:
            columns:
                incrementId:     { data_name: o.incrementId }
                itemsCount:      { data_name: itemsCount }
                createdAt:       { data_name: o.createdAt }
                updatedAt:       { data_name: o.updatedAt }
                subtotalAmount:  { data_name: o.subtotalAmount }
                totalPaidAmount: { data_name: o.totalPaidAmount }
                totalAmount:     { data_name: o.totalAmount }
                status:          { data_name: o.status }
            default:
                incrementId:  DESC
        properties:
            id: ~
            view_link:
                type: url
                route: orocrm_magento_order_view
                params: [ id ]
        actions:
            view:
                type:         navigate
                label:        oro.grid.action.view
                link:         view_link
                icon:         eye-open
                acl_resource: orocrm_magento_order_view
                rowAction:    true

    #FIXME: check group by
    magento-customer-cart-widget-grid:
        acl_resource: orocrm_magento_cart_view
        source:
            type: orm
            query:
                select:
                    - c.id
                    - c.originId
                    - c.grandTotal
                    - c.createdAt
                    - c.updatedAt
                    - c.quoteCurrencyCode as currency
                    - MAX(cstatus.label) as statusLabel
                    - c.itemsCount as itemsCount
                from:
                    - { table: %orocrm_magento.cart.entity.class% , alias: c }
                join:
                    left:
                        - { join: c.status, alias: cstatus }
                where:
                    and:
                        - c.customer = :customerId AND c.channel = :channelId
                groupBy: c.id
        columns:
            originId:
                label:            orocrm.magento.cart.id.label
            itemsCount:
                label:            orocrm.magento.cart.items_qty.label
                frontend_type:    integer
            createdAt:
                label:            oro.ui.created_at
                frontend_type:    datetime
            updatedAt:
                label:            oro.ui.updated_at
                frontend_type:    datetime
            grandTotal:
                label:            orocrm.magento.cart.grand_total.label
                type:             localized_number
                method:           formatCurrency
                context_resolver: OroCRM\Bundle\MagentoBundle\Grid\FormatterContextResolver::getResolverCurrencyClosure
                align:            right
            statusLabel:
                label:            orocrm.magento.datagrid.columns.status
        properties:
            id: ~
            view_link:
                type: url
                route: orocrm_magento_cart_view
                params: [ id ]
        sorters:
            columns:
                originId:             { data_name: c.originId }
                itemsCount:           { data_name: c.itemsCount }
                createdAt:            { data_name: c.createdAt }
                updatedAt:            { data_name: c.updatedAt }
                grandTotal:           { data_name: c.grandTotal }
                statusLabel:          { data_name: cstatus.label }
            default:
                updatedAt:  DESC
        filters:
            columns:
                originId:
                    type:            number-range
                    data_name:       c.originId
                itemsCount:
                    type:             number-range
                    data_name:        itemsCount
                    filter_by_having: true
                createdAt:
                    type:             datetime
                    data_name:        c.createdAt
                updatedAt:
                    type:             datetime
                    data_name:        c.updatedAt
                grandTotal:
                    type:             currency
                    data_name:        c.grandTotal
                statusLabel:
                    type:             entity
                    data_name:        c.status
                    options:
                        field_options:
                            class: OroCRMMagentoBundle:CartStatus
                            property: label
        actions:
            view:
                type:         navigate
                label:        oro.grid.action.view
                link:         view_link
                icon:         eye-open
                acl_resource: orocrm_magento_cart_view
                rowAction:    true

    magento-customers-group-by-channel-grid:
        extended_entity_name: %orocrm_magento.entity.customer_group.class%
        channel_limitation:
            channel_relation_path: dataChannel
        acl_resource: orocrm_magento_customer_view
        source:
            type: orm
            query:
                select:
                    - g.id
                    - g.name
                from:
                    - { table: %orocrm_magento.entity.customer_group.class%, alias: g }
                join:
                    left:
                        - { join: g.channel, alias: integrationChannel }
                        - { join: %orocrm_channel.entity.class%, alias: dataChannel, conditionType: WITH, condition: "dataChannel.dataSource = integrationChannel" }
        columns:
            name:
                label: orocrm.magento.customergroup.name.label
        properties:
            id: ~
        sorters:
            columns:
                name: { data_name: g.name }
            default:
                name:  ASC
        filters:
            columns:
                name:
                    type: string
                    data_name: g.name

    magento-store-by-channel-grid:
        extended_entity_name: %orocrm_magento.entity.store.class%
        channel_limitation:
            channel_relation_path: dataChannel
        acl_resource: orocrm_magento_customer_view
        source:
            type: orm
            query:
                select:
                    - s.id
                    - s.name
                    - s.code
                    - w.name as websiteName
                from:
                    - { table: %orocrm_magento.entity.store.class%, alias: s }
                join:
                    left:
                        - { join: s.website, alias: w }
                        - { join: s.channel, alias: integrationChannel }
                        - { join: %orocrm_channel.entity.class%, alias: dataChannel, conditionType: WITH, condition: "dataChannel.dataSource = integrationChannel" }
        columns:
            name:
                label: orocrm.magento.store.name.label
            code:
                label: orocrm.magento.store.code.label
            websiteName:
                label: orocrm.magento.store.website.label
        properties:
            id: ~
        sorters:
            columns:
                name: { data_name: s.name }
                code: { data_name: s.code }
                websiteName: { data_name: w.name }
            default:
                websiteName: ASC
                name:  ASC
        filters:
            columns:
                name:
                    type: string
                    data_name: s.name
                code:
                    type: string
                    data_name: s.code
                websiteName:
                    type: string
                    data_name: w.name

    magento-newsletter-subscriber-grid:
        extended_entity_name: %orocrm_magento.entity.newsletter_subscriber.class%
        acl_resource: orocrm_magento_newsletter_subscriber_view
        source:
            type: orm
            query:
                select:
                    - newsletterSubscriber.id
                    - customer.originId as OroCRM\Bundle\MagentoBundle\Datagrid\AbstractTwoWaySyncActionPermissionProvider::CUSTOMER_ORIGIN_ID
                    - customer.id as OroCRM\Bundle\MagentoBundle\Datagrid\AbstractTwoWaySyncActionPermissionProvider::CUSTOMER_ID
                    - dataChannel.name as channelName
                    - channel.id as OroCRM\Bundle\MagentoBundle\Datagrid\AbstractTwoWaySyncActionPermissionProvider::CHANNEL_KEY
                    - website.name as websiteName
                    - newsletterSubscriber.email
                    - CONCAT_WS(' ', customer.firstName, customer.lastName) as customerName
                    - customer.email as customerEmail
                    - newsletterSubscriber.createdAt
                    - newsletterSubscriber.updatedAt
                    - newsletterSubscriberStatus.id as newsletterSubscriberStatusId
                from:
                    - { table: %orocrm_magento.entity.newsletter_subscriber.class%, alias: newsletterSubscriber }
                join:
                    left:
                        - { join: newsletterSubscriber.customer, alias: customer }
                        - { join: newsletterSubscriber.dataChannel, alias: dataChannel }
                        - { join: newsletterSubscriber.channel, alias: channel }
                        - { join: newsletterSubscriber.store, alias: store }
                        - { join: newsletterSubscriber.status, alias: newsletterSubscriberStatus }
                        - { join: store.website, alias: website }
        columns:
            channelName:
                label: orocrm.magento.newslettersubscriber.data_channel.label
            websiteName:
                label: orocrm.magento.newslettersubscriber.website.label
            email:
                label: orocrm.magento.newslettersubscriber.email.label
            customerName:
                label: orocrm.magento.newslettersubscriber.customer.label
            customerEmail:
                label: orocrm.magento.newslettersubscriber.email.customer
            createdAt:
                label: oro.ui.created_at
                frontend_type: datetime
            updatedAt:
                label: oro.ui.updated_at
                frontend_type: datetime
        sorters:
            columns:
                channelName: { data_name: channelName }
                websiteName: { data_name: websiteName }
                email: { data_name: newsletterSubscriber.email }
                customerName: { data_name: customerName }
                customerEmail: { data_name: customerEmail }
                createdAt: { data_name: newsletterSubscriber.createdAt }
                updatedAt: { data_name: newsletterSubscriber.updatedAt }
            default:
                updatedAt: DESC
        filters:
            columns:
                channelName:
                    type: entity
                    data_name: dataChannel.id
                    options:
                        field_options:
                            class: OroCRMChannelBundle:Channel
                            property: name
                            translatable_options: false
                websiteName:
                    type: string
                    data_name: websiteName
                email:
                    type: string
                    data_name: newsletterSubscriber.email
                customerName:
                    type: string
                    data_name: customerName
                customerEmail:
                    type: string
                    data_name: customerEmail
                createdAt:
                    type: datetime
                    data_name: newsletterSubscriber.createdAt
                updatedAt:
                    type: datetime
                    data_name: newsletterSubscriber.updatedAt
        properties:
            id: ~
            view_link:
                type: url
                route: orocrm_magento_newsletter_subscriber_view
                params: [ id ]
            subscribe_link:
                type: url
                route: orocrm_magento_newsletter_subscriber_subscribe
                params: [ id ]
            unsubscribe_link:
                type: url
                route: orocrm_magento_newsletter_subscriber_unsubscribe
                params: [ id ]
        actions:
            view:
                type: navigate
                acl_resource: orocrm_magento_newsletter_subscriber_view
                label: oro.grid.action.view
                icon: eye-open
                link: view_link
                rowAction: true
            subscribe:
                type: ajaxdelete
                label: orocrm.magento.newslettersubscriber.action.subscribe
                link:  subscribe_link
                icon: plus
                acl_resource: orocrm_magento_newsletter_subscriber_subscribe
                defaultMessages:
                    confirm_title:   orocrm.magento.newslettersubscriber.action.confirm_title.subscribe
                    confirm_ok:      orocrm.magento.newslettersubscriber.action.confirm_ok
                    confirm_cancel:  orocrm.magento.newslettersubscriber.action.confirm_cancel
                    confirm_content: orocrm.magento.newslettersubscriber.action.content.subscribe
                    success:         orocrm.magento.newslettersubscriber.action.success.subscribe
                    error:           orocrm.magento.newslettersubscriber.action.error.subscribe
            unsubscribe:
                type: ajaxdelete
                label: orocrm.magento.newslettersubscriber.action.unsubscribe
                link: unsubscribe_link
                icon: minus
                acl_resource: orocrm_magento_newsletter_subscriber_unsubscribe
                defaultMessages:
                    confirm_title:   orocrm.magento.newslettersubscriber.action.confirm_title.unsubscribe
                    confirm_ok:      orocrm.magento.newslettersubscriber.action.confirm_ok
                    confirm_cancel:  orocrm.magento.newslettersubscriber.action.confirm_cancel
                    confirm_content: orocrm.magento.newslettersubscriber.action.content.unsubscribe
                    success:         orocrm.magento.newslettersubscriber.action.success.unsubscribe
                    error:           orocrm.magento.newslettersubscriber.action.error.unsubscribe
        action_configuration: [ "@orocrm_magento.datagrid.newsletter_subscriber_provider", "getActionsPermissions"]
        options:
            entityHint: newsletter subscriber
            export: true
            entity_pagination: true

    magento-customers-for-context-grid:
        extended_entity_name: OroCRM\Bundle\MagentoBundle\Entity\Customer
        acl_resource: orocrm_magento_customer_view
        source:
            type: orm
            query:
                select:
                    - c.id
                    - c.firstName
                    - c.lastName
                    - c.email
                    - dataChannel.name as channelName
                    - channel.id as OroCRM\Bundle\MagentoBundle\Datagrid\AbstractTwoWaySyncActionPermissionProvider::CHANNEL_KEY
                    - country.name as countryName
                    - CONCAT(CASE WHEN address.regionText IS NOT NULL THEN address.regionText ELSE region.name END, '') as regionName
                    - cw.name as websiteName
                    - c.originId as customerOriginId
                from:
                    - { table: OroCRM\Bundle\MagentoBundle\Entity\Customer , alias: c }
                join:
                    left:
                        - { join: c.dataChannel, alias: dataChannel }
                        - { join: c.channel, alias: channel }
                        - { join: c.addresses, alias: address,  conditionType: WITH, condition: "address.primary = true"}
                        - { join: address.country, alias: country }
                        - { join: address.region, alias: region }
                        - { join: c.website, alias: cw }
        columns:
            id:
                label:            orocrm.magento.customer.id.label
            channelName:
                label:            orocrm.magento.customer.data_channel.label
            websiteName:
                label:            orocrm.magento.customer.website.label
            firstName:
                label:            orocrm.magento.customer.first_name.label
            lastName:
                label:            orocrm.magento.customer.last_name.label
            email:
                label:            orocrm.magento.customer.email.label
        sorters:
            columns:
                firstName:   { data_name: c.firstName }
                lastName:    { data_name: c.lastName }
                email:       { data_name: c.email }
                channelName: { data_name: channelName }
                websiteName: { data_name: cw.name }
            default:
                lastName:  ASC
                firstName: ASC
        filters:
            columns:
                channelName:
                    type:      entity
                    data_name: dataChannel.id
                    options:
                        field_options:
                            class: OroCRMChannelBundle:Channel
                            property: name
                            translatable_options: false
                websiteName:
                    type: entity
                    data_name: cw.id
                    options:
                        field_options:
                            class: OroCRMMagentoBundle:Website
                            property: name
                            translatable_options: false
                    enabled: false
                firstName:
                    type: string
                    data_name: c.firstName
                lastName:
                    type: string
                    data_name: c.lastName
                email:
                    type: string
                    data_name: c.email
        options:
            entityHint: customer
            entity_pagination: true
            toolbarOptions:
                pageSize:
                    default_per_page: 10
            routerEnabled: false

    magento-order-for-context-grid:
        extended_entity_name: OroCRM\Bundle\MagentoBundle\Entity\Order
        acl_resource: orocrm_magento_order_view
        source:
            type: orm
            query:
                select:
                    - o.id
                    - o.currency
                    - o.incrementId
                    - o.createdAt
                    - o.updatedAt
                    - o.totalPaidAmount
                    - o.status
                    - o.firstName
                    - o.lastName
                    - o.subtotalAmount as subTotal
                    - o.totalAmount as grandTotal
                    - o.customerEmail as email
                    - country.name as countryName
                    - CONCAT(CASE WHEN address.regionText IS NOT NULL THEN address.regionText ELSE region.name END, '') as regionName
                    - channel.name as channelName
                    - cw.name as websiteName
                from:
                    - { table: OroCRM\Bundle\MagentoBundle\Entity\Order, alias: o }
                join:
                    left:
                        - { join: o.customer, alias: customer }
                        -
                            join: o.addresses
                            alias: address
                            conditionType: WITH
                            condition: "address.id IN (SELECT oa.id FROM OroCRMMagentoBundle:OrderAddress oa LEFT JOIN oa.types type WHERE type.name = 'billing')"
                        - { join: address.country, alias: country }
                        - { join: address.region, alias: region }
                        - { join: o.dataChannel, alias: channel }
                        - { join: o.store, alias: cs }
                        - { join: cs.website, alias: cw }
        columns:
            id:
                label:            orocrm.magento.order.id.label
            channelName:
                label:            orocrm.magento.order.data_channel.label
            websiteName:
                label:            orocrm.magento.order.website.label
            incrementId:
                label:            orocrm.magento.order.increment_id.label
            firstName:
                label:            orocrm.magento.datagrid.columns.first_name
            lastName:
                label:            orocrm.magento.datagrid.columns.last_name
            email:
                label:            orocrm.magento.datagrid.columns.email
            createdAt:
                label:            oro.ui.created_at
                frontend_type:    datetime
            updatedAt:
                label:            oro.ui.updated_at
                frontend_type:    datetime
            countryName:
                label:            orocrm.magento.datagrid.columns.billing_country
            regionName:
                label:            orocrm.magento.datagrid.columns.billing_region
            status:
                label:            orocrm.magento.order.status.label
        properties:
            id: ~
            view_link:
                type: url
                route: orocrm_magento_order_view
                params: [ id ]
        sorters:
            columns:
                incrementId:            { data_name: o.incrementId }
                firstName:              { data_name: o.firstName }
                lastName:               { data_name: o.lastName }
                email:                  { data_name: email }
                countryName:            { data_name: country.name }
                regionName:             { data_name: regionName }
                status:                 { data_name: o.status }
                channelName:            { data_name: channelName }
                websiteName:            { data_name: cw.name }
                createdAt:              { data_name: o.createdAt }
                updatedAt:              { data_name: o.updatedAt }
            default:
                createdAt:  DESC
        filters:
            columns:
                channelName:
                    type:      entity
                    data_name: channel.id
                    options:
                        field_options:
                            class: OroCRMChannelBundle:Channel
                            property: name
                            translatable_options: false
                websiteName:
                    type: entity
                    data_name: cw.id
                    options:
                        field_options:
                            class: OroCRMMagentoBundle:Website
                            property: name
                            translatable_options: false
                    enabled:   false
                incrementId:
                    type:             string
                    data_name:        o.incrementId
                firstName:
                    type:             string
                    data_name:        o.firstName
                lastName:
                    type:             string
                    data_name:        o.lastName
                email:
                    type:             string
                    data_name:        email
                countryName:
                    type:      entity
                    data_name: address.country
                    enabled:   false
                    options:
                        field_options:
                            class: OroAddressBundle:Country
                            property: name
                            query_builder:  "@orocrm_magento.country.datagrid_helper->getCountryFilterQueryBuilder"
                            translatable_options: false
                regionName:
                    type:      string
                    data_name: regionName
                    enabled:   false
                status:
                    type:             string
                    data_name:        o.status
                createdAt:
                    type:             datetime
                    data_name:        o.createdAt
                    enabled:          false
                updatedAt:
                    type:             datetime
                    data_name:        o.updatedAt
                    enabled:          false
        options:
            entityHint: order
            entity_pagination: true
            toolbarOptions:
                pageSize:
                    default_per_page: 10
            routerEnabled: false

    magento-cart-for-context-grid:
        extended_entity_name: OroCRM\Bundle\MagentoBundle\Entity\Cart
        acl_resource: orocrm_magento_cart_view
        source:
            type: orm
            query:
                select:
                    - c.id
                    - c.originId
                    - c.email
                    - c.firstName
                    - c.lastName
                    - c.quoteCurrencyCode as currency
                    - c.grandTotal
                    - c.createdAt
                    - c.updatedAt
                    - cstatus.label as statusLabel
                    - channel.name as channelName
                    - cw.name as websiteName
                from:
                    - { table: OroCRM\Bundle\MagentoBundle\Entity\Cart , alias: c }
                join:
                    left:
                        - { join: c.store, alias: cs }
                        - { join: c.dataChannel, alias: channel }
                        - { join: c.status, alias: cstatus }
                        - { join: c.billingAddress, alias: address }
                        - { join: address.country, alias: country }
                        - { join: address.region, alias: region }
                        - { join: cs.website, alias: cw }
        columns:
            id:
                label:            orocrm.magento.cart.id.label
            channelName:
                label:            orocrm.magento.cart.data_channel.label
            websiteName:
                label:            orocrm.magento.cart.website.label
            firstName:
                label:            orocrm.magento.datagrid.columns.first_name
            lastName:
                label:            orocrm.magento.datagrid.columns.last_name
            email:
                label:            orocrm.magento.cart.email.label
            grandTotal:
                label:            orocrm.magento.cart.grand_total.label
                type:             localized_number
                method:           formatCurrency
                context_resolver: OroCRM\Bundle\MagentoBundle\Grid\FormatterContextResolver::getResolverCurrencyClosure
                align:            right
            createdAt:
                label:            oro.ui.created_at
                frontend_type:    datetime
            updatedAt:
                label:            oro.ui.updated_at
                frontend_type:    datetime
            statusLabel:
                label:            orocrm.magento.datagrid.columns.status
        properties:
            id: ~
            view_link:
                type: url
                route: orocrm_magento_cart_view
                params: [ id ]
        sorters:
            columns:
                firstName:   { data_name: c.firstName }
                lastName:    { data_name: c.lastName }
                email:       { data_name: c.email }
                channelName: { data_name: channelName }
                websiteName: { data_name: cw.name }
                grandTotal:  { data_name: c.grandTotal }
                createdAt:   { data_name: c.createdAt }
                updatedAt:   { data_name: c.updatedAt }
                statusLabel: { data_name: cstatus.label }
            default:
                updatedAt:  DESC
        filters:
            columns:
                channelName:
                    type:      entity
                    data_name: channel.id
                    options:
                        field_options:
                            class: OroCRMChannelBundle:Channel
                            property: name
                            translatable_options: false
                websiteName:
                    type: entity
                    data_name: cw.id
                    options:
                        field_options:
                            class: OroCRMMagentoBundle:Website
                            property: name
                    enabled:   false
                firstName:
                    type: string
                    data_name: c.firstName
                lastName:
                    type: string
                    data_name: c.lastName
                email:
                    type: string
                    data_name: c.email
                grandTotal:
                    type: currency
                    data_name: c.grandTotal
                statusLabel:
                    type: entity
                    data_name: c.status
                    options:
                        field_options:
                            class: OroCRMMagentoBundle:CartStatus
                            property: label
                            translatable_options: false
                createdAt:
                    type:      datetime
                    data_name: c.createdAt
                    enabled: false
                updatedAt:
                    type:      datetime
                    data_name: c.updatedAt
                    enabled: false
        options:
            entityHint: cart
            entity_pagination: true
            toolbarOptions:
                pageSize:
                    default_per_page: 10
            routerEnabled: false
