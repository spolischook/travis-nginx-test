services:
    oro_messaging.zero_config.config:
        class: 'Oro\Component\Messaging\ZeroConfig\Config'
        public: false

    oro_messaging.zero_config.session:
        class: 'Oro\Component\Messaging\ZeroConfig\Session'
        public: false
        factory: ['Oro\Component\Messaging\ZeroConfig\SessionFactory', 'create']
        arguments:
            - '@oro_messaging.transport.connection'
            - '@oro_messaging.zero_config.config'

    oro_messaging.zero_config.front_producer:
        class: 'Oro\Component\Messaging\ZeroConfig\FrontProducer'
        factory: ['@oro_messaging.zero_config.session', 'createFrontProducer']

    oro_messaging.zero_config.router:
        class: 'Oro\Component\Messaging\ZeroConfig\Router'
        public: false
        arguments:
            - '@oro_messaging.zero_config.session'
            - []

    oro_messaging.zero_config.route_message_processor:
        class: 'Oro\Component\Messaging\Router\RouterMessageProcessor'
        public: false
        arguments:
            - '@oro_messaging.zero_config.router'
        tags:
            - { name: 'oro_messaging.zero_config.message_processor', topicName: '__router__' }

    oro_messaging.zero_config.message_processor_registry:
        class: 'Oro\Component\Messaging\ZeroConfig\ContainerAwareMessageProcessorRegistry'
        public: false
        calls:
            - ['setContainer', ['@service_container']]

    oro_messaging.zero_config.delegate_message_processor:
        class: 'Oro\Component\Messaging\ZeroConfig\DelegateMessageProcessor'
        public: false
        arguments:
            - '@oro_messaging.zero_config.message_processor_registry'

    oro_messaging.zero_config.extension.create_queue:
        class: 'Oro\Component\Messaging\ZeroConfig\ConsumptionExtension\CreateQueueExtension'
        public: false
        arguments:
            - '@oro_messaging.zero_config.session'

    oro_messaging.zero_config.extensions:
        class: 'Oro\Component\Messaging\Consumption\Extensions'
        public: false
        arguments:
            -
                - '@oro_messaging.consumption.extensions'
                - '@oro_messaging.zero_config.extension.create_queue'

    oro_messaging.zero_config.queue_consumer:
        class: 'Oro\Component\Messaging\Consumption\QueueConsumer'
        public: false
        arguments:
            - '@oro_messaging.transport.connection'
            - '@oro_messaging.zero_config.extensions'

    oro_messaging.zero_config.consume_messages_command:
        class: 'Oro\Component\Messaging\ZeroConfig\ConsumeMessagesCommand'
        arguments:
            - '@oro_messaging.zero_config.queue_consumer'
            - '@oro_messaging.zero_config.delegate_message_processor'
            - '@oro_messaging.zero_config.session'
        tags:
            - { name: 'console.command' }
