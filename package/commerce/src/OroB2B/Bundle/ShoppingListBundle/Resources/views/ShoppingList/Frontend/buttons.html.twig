{% macro addToShoppingListButton(options) -%}
    {% import _self as buttons %}

    {% set dataAttributes = options.dataAttributes %}
    {% if options.dataUrl %}
        {% set dataAttributes = dataAttributes|merge({
            urlOptions: (options.dataUrlOptions|merge({shoppingListId: options.shoppingList.id}))|json_encode
        }) %}
    {% endif %}

    {% set btnOptions = {
        dataUrl: options.dataUrl,
        dataAttributes: dataAttributes,
        btnLabel: options.shoppingList.label,
        btnId: options.shoppingList.id,
        dataId: options.shoppingList.id,
        actionLabel: 'orob2b.shoppinglist.actions.add_to_shopping_list'|trans({'{{ shoppingList }}': options.shoppingList.label})
    } %}

    {{ buttons.getButton(btnOptions) }}
{% endmacro %}

{% macro addToNewShoppingListButton(options) %}
    {% import _self as buttons %}

    {% set dataAttributes = options.dataAttributes|merge({
        intention: 'new',
    }) %}
    {% if options.dataUrl %}
        {% set dataAttributes = dataAttributes|merge({
            urlOptions: options.dataUrlOptions|json_encode
        }) %}
    {% endif %}

    {% set btnOptions = {
        dataUrl: options.dataUrl,
        dataAttributes: dataAttributes,
        btnLabel: 'orob2b.shoppinglist.actions.add_to_new_shopping_list'|trans,
        dataId: null,
        actionLabel: null
    } %}

    {{ buttons.getButton(btnOptions) }}
{% endmacro %}

{% macro addToShoppingListButtonTemplate(options) %}
{% spaceless %}
    {% import _self as buttons %}
    {{ buttons.addToCurrentShoppingListButton(options|merge({
        shoppingList: {
            id: '<%= id %>',
            label: '<%= label %>'
        }
    }))|replace({
        '&lt;%': '<%',
        '%&gt;': '%>'
    })|raw }}
{% endspaceless %}
{% endmacro %}

{% macro addToCurrentShoppingListButton(options) %}
    {% import _self as buttons %}

    {% set shoppingListId = options.shoppingList ? options.shoppingList.id : null %}

    {% set dataAttributes = options.dataAttributes %}
    {% if options.dataUrl %}
        {% set dataAttributes = dataAttributes|merge({
            urlOptions: (options.dataUrlOptions|merge({shoppingListId: shoppingListId}))|json_encode
        }) %}
    {% endif %}

    {% set label = options.shoppingList ? options.shoppingList.label : 'orob2b.shoppinglist.entity_label'|trans %}
    {% set btnOptions = {
        dataUrl: options.dataUrl,
        dataAttributes: dataAttributes,
        btnLabel: label,
        dataId: shoppingListId,
        actionLabel: 'orob2b.shoppinglist.actions.add_to_shopping_list'|trans({'{{ shoppingList }}': label})
    } %}
    {% if options.aCss is defined %}
        {% set btnOptions = btnOptions|merge({
        'aCss': options.aCss,
        }) %}
    {% endif %}

    {{ buttons.getButton(btnOptions) }}
{% endmacro %}

{% macro getButton(options) %}
    {% import 'OroUIBundle::macros.html.twig' as UI %}
    {% set buttonOptions = {
        'dataAttributes': options.dataAttributes,
        'aCss': 'direct-link add-to-shopping-list-button',
        'dataId': options.dataId,
        'label' : options.actionLabel|default(options.btnLabel)
    } %}
    {% if options.dataUrl %}
        {% set buttonOptions = buttonOptions|merge({
            'dataUrl': options.dataUrl,
        }) %}
    {% endif %}

    {% if options.aCss is defined %}
        {% set buttonOptions = buttonOptions|merge({
        'aCss': buttonOptions.aCss ~ ' ' ~ options.aCss,
        }) %}
    {% endif %}
    {{ UI.clientButton(buttonOptions) }}
{% endmacro %}

{% macro createAddToShoppingListButton(options) %}
    {% import 'OroUIBundle::macros.html.twig' as UI %}
    {% import _self as buttons %}
    {% set buttonsHtml %}
        {% set existingShoppingLists = [] %}
        {% for shoppingList in options.shoppingLists %}
            {% if shoppingList.current %}
                {{ buttons.addToCurrentShoppingListButton(options.current|merge({shoppingList: shoppingList})) }}
            {% else %}
                {%  set existingShoppingLists = existingShoppingLists|merge([shoppingList]) %}
            {% endif %}
        {% else %}
            {% set aCss = options.singleButtonACss is defined ? options.singleButtonACss : "" %}
            {{ buttons.addToCurrentShoppingListButton(options.current|merge({shoppingList: null, aCss: aCss})) }}
        {% endfor %}
        {% for shoppingList in existingShoppingLists %}
            {{ buttons.addToShoppingListButton(options.existing|merge({shoppingList: shoppingList})) }}
        {% endfor %}
        {% if options.shoppingLists is not empty %}
            {{ buttons.addToNewShoppingListButton(options.new) }}
        {% endif %}
    {% endset %}
    {% set customOptions = {}
        |merge(options.groupContainer|default(false) ? {'groupContainer': options.groupContainer} : {} )
        |merge(options.truncateLabelLength|default(false) ? {'truncateLength': options.truncateLabelLength} : {} )
    %}
    {{ UI.pinnedDropdownButton({
        'html': buttonsHtml,
        'options': {
            'addButtonEvent': 'shopping-list:created',
            'buttonTemplate': buttons.addToShoppingListButtonTemplate(options.current),
            'truncateLength': 15
        }|merge(customOptions)
    }) }}
{% endmacro %}
