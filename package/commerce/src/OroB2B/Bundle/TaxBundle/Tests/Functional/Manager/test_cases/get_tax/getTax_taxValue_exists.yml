method: getTax
reference: simple_order
configuration: { use_as_base_by_default: destination }
databaseBefore:
    'OroB2B\Bundle\OrderBundle\Entity\Order':
        simple_order:
            poNumber: { property_value: simple_order }
            account: { class: 'OroB2B\Bundle\AccountBundle\Entity\Account', query: {} }
            billingAddress:
                class: 'OroB2B\Bundle\OrderBundle\Entity\OrderAddress'
                property_value:
                    country: { class: 'Oro\Bundle\AddressBundle\Entity\Country', query: { iso2Code: 'US' } }
                    region: { class: 'Oro\Bundle\AddressBundle\Entity\Region', query: { combinedCode: 'US-AL' } }
            shippingAddress:
                class: 'OroB2B\Bundle\OrderBundle\Entity\OrderAddress'
                property_value:
                    country: { class: 'Oro\Bundle\AddressBundle\Entity\Country', query: { iso2Code: 'US' } }
                    region: { class: 'Oro\Bundle\AddressBundle\Entity\Region', query: { combinedCode: 'US-AL' } }
    'OroB2B\Bundle\OrderBundle\Entity\OrderLineItem':
        order_line_item_1:
            productSku: { property_value: order_line_item_1 }
            order: { reference: simple_order }
            quantity: { property_value: 5 }
            price: { class: 'Oro\Bundle\CurrencyBundle\Entity\Price', property_value: { value: '15.99', currency: USD } }
        order_line_item_2:
            productSku: { property_value: order_line_item_2 }
            order: { reference: simple_order }
            quantity: { property_value: 6 }
            price: { class: 'Oro\Bundle\CurrencyBundle\Entity\Price', property_value: { value: '5.55', currency: USD } }
    'OroB2B\Bundle\TaxBundle\Entity\TaxApply':
        simple_order_tax_value_applied_tax:
            tax: { class: 'OroB2B\Bundle\TaxBundle\Entity\Tax', query: { code: 'TAX1' } }
            rate: { class: 'OroB2B\Bundle\TaxBundle\Entity\Tax', query: { code: 'TAX1' }, property: rate }
            taxableAmount: { property_value: '113.25' }
            taxAmount: { property_value: '11.325' }
    'OroB2B\Bundle\TaxBundle\Entity\TaxValue':
        simple_order_tax_value:
            entityClass: { property_value: 'OroB2B\Bundle\OrderBundle\Entity\Order' }
            entityId: { reference: simple_order, property: id }
            address: { property_value: address }
            result:
                class: 'OroB2B\Bundle\TaxBundle\Model\Result'
                property_value:
                    total:
                        class: 'OroB2B\Bundle\TaxBundle\Model\ResultElement'
                        property_value:
                            includingTax: '123'
                            excludingTax: '123'
                            taxAmount: '0'
                            adjustment: '0'
            appliedTaxes:
                property_value:
                    - { reference: simple_order_tax_value_applied_tax }
expectedResult:
    total:
        includingTax: '124.57' # 87.945 + 36.63 + -0.005
        excludingTax: '113.25' # 79.95 + 33.3
        taxAmount: '11.32'     # 8 + 3.36 + -0.035
        adjustment: '-0.005'   # -0.005
    items:
        -
            row:
                includingTax: '87.95' # 17.589 * 5 = 87.945
                excludingTax: '79.95' # 15.99 * 5
                taxAmount: '8'        # 1.599 * 5 = 7.995
                adjustment: '-0.005'
            unit:
                includingTax: '17.59' # 15.99 + 1.599 = 17.589
                excludingTax: '15.99'
                taxAmount: '1.6'      # 15.99 * 0.1 = 1.599
                adjustment: '-0.001'
            taxes:
                - { tax: 'TAX1', rate: '0.1', taxable_amount: '79.95', tax_amount: '8' }
        -
            row:
                includingTax: '36.63' # 6.105 * 6
                excludingTax: '33.3'  # 5.55 * 6
                taxAmount: '3.33'     # 0.555 * 6
                adjustment: '0'
            unit:
                includingTax: '6.11'  # 5.55 + 0.555 = 6.105
                excludingTax: '5.55'
                taxAmount: '0.56'     # 5.55 * 0.1 = 0.555
                adjustment: '-0.005'
            taxes:
                - { tax: 'TAX1', rate: '0.1', taxable_amount: '33.3', tax_amount: '3.33' }
    taxes:
        - { tax: 'TAX1', rate: '0.1', taxable_amount: '113.25', tax_amount: '11.33' }
