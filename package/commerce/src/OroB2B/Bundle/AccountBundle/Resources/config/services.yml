parameters:
    orob2b_account.security.account_user_provider.class: OroB2B\Bundle\AccountBundle\Security\AccountUserProvider

    orob2b_account.entity.account.class: OroB2B\Bundle\AccountBundle\Entity\Account
    orob2b_account.entity.account_address.class: OroB2B\Bundle\AccountBundle\Entity\AccountAddress
    orob2b_account.entity.account_group.class: OroB2B\Bundle\AccountBundle\Entity\AccountGroup
    orob2b_account.entity.account_user.class: OroB2B\Bundle\AccountBundle\Entity\AccountUser
    orob2b_account.entity.account_user_address.class: OroB2B\Bundle\AccountBundle\Entity\AccountUserAddress
    orob2b_account.entity.account_user_role.class: OroB2B\Bundle\AccountBundle\Entity\AccountUserRole
    orob2b_account.entity.audit.class: OroB2B\Bundle\AccountBundle\Entity\Audit
    orob2b_account.entity.navigation_item.class: OroB2B\Bundle\AccountBundle\Entity\NavigationItem
    orob2b_account.entity.navigation_history_item.class: OroB2B\Bundle\AccountBundle\Entity\NavigationHistoryItem
    orob2b_account.entity.pinbar_tab.class: OroB2B\Bundle\AccountBundle\Entity\PinbarTab
    orob2b_account.entity.sidebar_state.class: OroB2B\Bundle\AccountBundle\Entity\AccountUserSidebarState
    orob2b_account.entity.widget.class: OroB2B\Bundle\AccountBundle\Entity\AccountUserSidebarWidget
    orob2b_account.entity.page_state.class: OroB2B\Bundle\AccountBundle\Entity\PageState
    orob2b_account.entity.category_visibility.class: OroB2B\Bundle\AccountBundle\Entity\Visibility\CategoryVisibility
    orob2b_account.entity.account_category_visibility.class: OroB2B\Bundle\AccountBundle\Entity\Visibility\AccountCategoryVisibility
    orob2b_account.entity.account_group_category_visibility.class: OroB2B\Bundle\AccountBundle\Entity\Visibility\AccountGroupCategoryVisibility
    orob2b_account.entity.category_visibility_resolved.class: OroB2B\Bundle\AccountBundle\Entity\VisibilityResolved\CategoryVisibilityResolved
    orob2b_account.entity.account_category_visibility_resolved.class: OroB2B\Bundle\AccountBundle\Entity\VisibilityResolved\AccountCategoryVisibilityResolved
    orob2b_account.entity.account_group_category_visibility_resolved.class: OroB2B\Bundle\AccountBundle\Entity\VisibilityResolved\AccountGroupCategoryVisibilityResolved
    orob2b_account.entity.product_visibility.class: OroB2B\Bundle\AccountBundle\Entity\Visibility\ProductVisibility
    orob2b_account.entity.account_product_visibility.class: OroB2B\Bundle\AccountBundle\Entity\Visibility\AccountProductVisibility
    orob2b_account.entity.account_group_product_visibility.class: OroB2B\Bundle\AccountBundle\Entity\Visibility\AccountGroupProductVisibility
    orob2b_account.entity.windows_state.class: OroB2B\Bundle\AccountBundle\Entity\WindowsState
    orob2b_account.entity.account_product_visibility_resolved.class: OroB2B\Bundle\AccountBundle\Entity\VisibilityResolved\AccountProductVisibilityResolved
    orob2b_account.entity.account_group_product_visibility_resolved.class: OroB2B\Bundle\AccountBundle\Entity\VisibilityResolved\AccountGroupProductVisibilityResolved
    orob2b_account.entity.product_visibility_resolved.class: OroB2B\Bundle\AccountBundle\Entity\VisibilityResolved\ProductVisibilityResolved

    orob2b_account.account_tree_handler.class: OroB2B\Bundle\AccountBundle\JsTree\AccountTreeHandler
    orob2b_account.account_delete_handler.class: OroB2B\Bundle\AccountBundle\Handler\UserDeleteHandler

    orob2b_account.manager.api.attribute.class: Oro\Bundle\SoapBundle\Entity\Manager\ApiEntityManager

    orob2b_account.form.autocomplete.parent_account.search_handler.class: OroB2B\Bundle\AccountBundle\Autocomplete\ParentAccountSearchHandler
    orob2b_account.form.autocomplete.account_account_user.search_handler.class: OroB2B\Bundle\AccountBundle\Autocomplete\AccountAccountUserSearchHandler

    orob2b_account.account_user.manager.api.class: Oro\Bundle\SoapBundle\Entity\Manager\ApiEntityManager
    orob2b_account.account_user_role.manager.api.class: Oro\Bundle\SoapBundle\Entity\Manager\ApiEntityManager
    orob2b_account.datagrid.action_permission_provider.class: OroB2B\Bundle\AccountBundle\Datagrid\ActionPermissionProvider
    orob2b_account.datagrid.account_action_permission_provider.class: OroB2B\Bundle\AccountBundle\Datagrid\AccountActionPermissionProvider
    orob2b_account.datagrid.extension.accoun_user.class: OroB2B\Bundle\AccountBundle\Datagrid\Extension\AccountUserExtension
    orob2b_account.datagrid.extension.accoun_user_by_account.class: OroB2B\Bundle\AccountBundle\Datagrid\Extension\AccountUserByAccountExtension
    orob2b_account.mailer.processor.class: OroB2B\Bundle\AccountBundle\Mailer\Processor
    orob2b_account_user.manager.class: OroB2B\Bundle\AccountBundle\Entity\AccountUserManager

    orob2b_account.account_user_menu.builder.class: OroB2B\Bundle\AccountBundle\Menu\AccountUserMenuBuilder
    orob2b_account.placeholder.filter.class:  OroB2B\Bundle\AccountBundle\Placeholder\PlaceholderFilter

    orob2b_account.account_user.password.handler.abstract.class: OroB2B\Bundle\AccountBundle\Form\Handler\AbstractAccountUserPasswordHandler
    orob2b_account.account_user.password_request.handler.class: OroB2B\Bundle\AccountBundle\Form\Handler\AccountUserPasswordRequestHandler
    orob2b_account.account_user.password_reset.handler.class: OroB2B\Bundle\AccountBundle\Form\Handler\AccountUserPasswordResetHandler

    #Listeners
    orob2b_account.event_listener.category_listener.class: OroB2B\Bundle\AccountBundle\EventListener\CategoryListener
    orob2b_account.event_listener.login.class: OroB2B\Bundle\AccountBundle\EventListener\LoginListener
    orob2b_account.event_listener.ormdatasource_acl.class: OroB2B\Bundle\AccountBundle\EventListener\OrmDatasourceAclListener
    orob2b_account.event_listener.system_config.class: OroB2B\Bundle\AccountBundle\EventListener\SystemConfigListener
    orob2b_account.event_listener.visibility_grid_listener.class: OroB2B\Bundle\AccountBundle\EventListener\VisibilityGridListener
    orob2b_account.event_listener.default_visibility.class: OroB2B\Bundle\AccountBundle\EventListener\DefaultVisibilityListener

    orob2b_account.event_listener.category_tree_handler_listener.class: OroB2B\Bundle\AccountBundle\EventListener\CategoryTreeHandlerListener
    orob2b_account.event_listener.product_duplicate_listener.class: OroB2B\Bundle\AccountBundle\EventListener\ProductDuplicateListener

    orob2b_account.event_listener.product_select_db_query.class: OroB2B\Bundle\AccountBundle\EventListener\ProductSelectDBQueryEventListener

    # Datagrid Listeners
    orob2b_account.event_listener.datagrid.account_user.class: OroB2B\Bundle\AccountBundle\EventListener\Datagrid\AccountUserDatagridListener
    orob2b_account.event_listener.datagrid.account.class: OroB2B\Bundle\AccountBundle\EventListener\Datagrid\AccountDatagridListener
    orob2b_account.event_listener.datagrid.website.class: OroB2B\Bundle\AccountBundle\EventListener\Datagrid\WebsiteDatagridListener
    orob2b_account.event_listener.datagrid.account_user_role.class: OroB2B\Bundle\AccountBundle\EventListener\Datagrid\AccountUserRoleDatagridListener

    # Acl
    orob2b_account.acl.group_provider.class: OroB2B\Bundle\AccountBundle\Acl\Group\AclGroupProvider
    orob2b_account.acl.resolver.role_translation_prefix.class: OroB2B\Bundle\AccountBundle\Acl\Resolver\RoleTranslationPrefixResolver
    orob2b_account.account_address.manager.api.class: Oro\Bundle\SoapBundle\Entity\Manager\ApiEntityManager
    orob2b_account.account_user_address.manager.api.class: Oro\Bundle\SoapBundle\Entity\Manager\ApiEntityManager

    #Twig
    orob2b_account.twig.account_extension.class: OroB2B\Bundle\AccountBundle\Twig\AccountExtension
    #Voters
    orob2b_account.acl.voter.account_user_role.class: OroB2B\Bundle\AccountBundle\Acl\Voter\AccountUserRoleVoter
    orob2b_account.acl.voter.account.class: OroB2B\Bundle\AccountBundle\Acl\Voter\AccountVoter
    orob2b_account.acl.voter.product_visibility.class: OroB2B\Bundle\AccountBundle\Acl\Voter\ProductVisibilityVoter

    orob2b_account.item.builder.pinbar.class: Oro\Bundle\NavigationBundle\Entity\Builder\PinbarTabBuilder
    orob2b_account.item.builder.favorite.class: Oro\Bundle\NavigationBundle\Entity\Builder\NavigationItemBuilder
    orob2b_account.item.builder.history.class: Oro\Bundle\NavigationBundle\Entity\Builder\HistoryItemBuilder

    orob2b_account.navigation_item_menu.builder.class: Oro\Bundle\NavigationBundle\Menu\NavigationItemBuilder
    orob2b_account.history_menu.builder.class: Oro\Bundle\NavigationBundle\Menu\NavigationHistoryBuilder
    orob2b_account.navigation_mostviewed_menu.builder.class: Oro\Bundle\NavigationBundle\Menu\NavigationMostviewedBuilder
    orob2b_account.item.pinbar.post_persist_listener.class: Oro\Bundle\NavigationBundle\Entity\Listener\PinbarPostPersist

    orob2b_account.content_provider.menu.class: Oro\Bundle\NavigationBundle\ContentProvider\MenuContentProvider

    orob2b.account.catalog.visibility.change_set.validatior.class: OroB2B\Bundle\AccountBundle\Validator\Constraints\VisibilityChangeSetValidator

    orob2b_account.provider.visibility_choices.class: OroB2B\Bundle\AccountBundle\Provider\VisibilityChoicesProvider
    orob2b_account.provider.sign_in.class: OroB2B\Bundle\AccountBundle\Layout\DataProvider\SignInProvider
    orob2b_account.provider.frontend_account_user_registration_form.class: OroB2B\Bundle\AccountBundle\Layout\DataProvider\FrontendAccountUserRegistrationFormProvider
    orob2b_account.provider.frontend_account_user_role_privileges.class: OroB2B\Bundle\AccountBundle\Layout\DataProvider\FrontendAccountUserRolePrivilegesDataProvider
    orob2b_account.provider.frontend_account_user_role_form.class: OroB2B\Bundle\AccountBundle\Layout\DataProvider\FrontendAccountUserRoleFormDataProvider

    orob2b_account.audit.discriminator_map_listener.class: OroB2B\Bundle\AccountBundle\Audit\DiscriminatorMapListener

    orob2b_account.helper.account_user_role_privileges.class: OroB2B\Bundle\AccountBundle\Helper\AccountUserRolePrivilegesHelper

    # Visibility resolver
    orob2b_account.visibility.resolver.category_visibility_resolver.class: OroB2B\Bundle\AccountBundle\Visibility\Resolver\CategoryVisibilityResolver

    # Model
    orob2b_account.model.product_visibility_query_builder_modifier.class: OroB2B\Bundle\AccountBundle\Model\ProductVisibilityQueryBuilderModifier

    # Actions
    orob2b_account.model.action.abstract_entity_aware_action.class: OroB2B\Bundle\AccountBundle\Model\Action\AbstractEntityAwareAction
    orob2b_account.model.action.abstract_visibility_action.class: OroB2B\Bundle\AccountBundle\Model\Action\AbstractVisibilityAction
    orob2b_account.model.action.abstract_visibility_registry_aware_action.class: OroB2B\Bundle\AccountBundle\Model\Action\AbstractVisibilityRegistryAwareAction
    orob2b_account.model.action.change_category_visibility.class: OroB2B\Bundle\AccountBundle\Model\Action\ChangeCategoryVisibility
    orob2b_account.model.action.change_category_position.class: OroB2B\Bundle\AccountBundle\Model\Action\ChangeCategoryPosition
    orob2b_account.model.action.resolve_product_visibility.class: OroB2B\Bundle\AccountBundle\Model\Action\ResolveProductVisibility
    orob2b_account.model.action.change_product_category.class: OroB2B\Bundle\AccountBundle\Model\Action\ChangeProductCategory
    orob2b_account.model.action.build_website_cache.class: OroB2B\Bundle\AccountBundle\Model\Action\BuildWebsiteCacheAction

    # Visibility cache
    orob2b_account.visibility.cache.product.cache_builder.abstract.class: OroB2B\Bundle\AccountBundle\Visibility\Cache\Product\AbstractResolvedCacheBuilder

    orob2b_account.visibility.cache.product.account_group_product_resolved_cache_builder.class: OroB2B\Bundle\AccountBundle\Visibility\Cache\Product\AccountGroupProductResolvedCacheBuilder
    orob2b_account.visibility.cache.product.account_product_resolved_cache_builder.class: OroB2B\Bundle\AccountBundle\Visibility\Cache\Product\AccountProductResolvedCacheBuilder
    orob2b_account.visibility.cache.product.product_resolved_cache_builder.class: OroB2B\Bundle\AccountBundle\Visibility\Cache\Product\ProductResolvedCacheBuilder

    orob2b_account.visibility.cache.product.category.account_group_category_resolved_cache_builder.class: OroB2B\Bundle\AccountBundle\Visibility\Cache\Product\Category\AccountGroupCategoryResolvedCacheBuilder
    orob2b_account.visibility.cache.product.category.account_category_resolved_cache_builder.class: OroB2B\Bundle\AccountBundle\Visibility\Cache\Product\Category\AccountCategoryResolvedCacheBuilder
    orob2b_account.visibility.cache.product.category.category_resolved_cache_builder.class: OroB2B\Bundle\AccountBundle\Visibility\Cache\Product\Category\CategoryResolvedCacheBuilder

    orob2b_account.visibility.cache.product.category.subtree.category_subtree_cache_builder.class: OroB2B\Bundle\AccountBundle\Visibility\Cache\Product\Category\Subtree\AbstractSubtreeCacheBuilder
    orob2b_account.visibility.cache.product.category.subtree.position_change_category_subtree_cache_builder.class: OroB2B\Bundle\AccountBundle\Visibility\Cache\Product\Category\Subtree\PositionChangeCategorySubtreeCacheBuilder
    orob2b_account.visibility.cache.product.category.subtree.visibility_change_category_subtree_cache_builder.class: OroB2B\Bundle\AccountBundle\Visibility\Cache\Product\Category\Subtree\VisibilityChangeCategorySubtreeCacheBuilder
    orob2b_account.visibility.cache.product.category.subtree.visibility_change_account_subtree_cache_builder.class: OroB2B\Bundle\AccountBundle\Visibility\Cache\Product\Category\Subtree\VisibilityChangeAccountSubtreeCacheBuilder
    orob2b_account.visibility.cache.product.category.subtree.visibility_change_group_subtree_cache_builder.class: OroB2B\Bundle\AccountBundle\Visibility\Cache\Product\Category\Subtree\VisibilityChangeGroupSubtreeCacheBuilder

    orob2b_account.visibility.cache.product.cache_builder.class: OroB2B\Bundle\AccountBundle\Visibility\Cache\Product\CacheBuilder
    orob2b_account.visibility.cache.product.category.cache_builder.class: OroB2B\Bundle\AccountBundle\Visibility\Cache\Product\Category\CacheBuilder
    orob2b_account.visibility.cache.cache_builder.class: OroB2B\Bundle\AccountBundle\Visibility\Cache\CompositeCacheBuilder

    orob2b_account.doctrine.filters_listener.class: OroB2B\Bundle\AccountBundle\Doctrine\DoctrineFiltersListener

services:
    orob2b_account.security.account_user_provider:
        class: %orob2b_account.security.account_user_provider.class%
        arguments:
            - @oro_security.security_facade
            - @oro_security.acl.manager
        calls:
            - [setAccountUserClass, [%orob2b_account.entity.account_user.class%]]

    orob2b_account.acl.voter.account:
        class: %orob2b_account.acl.voter.account.class%
        arguments:
            - @oro_entity.doctrine_helper
        calls:
            - [setContainer, [@service_container]]
        tags:
            - { name: security.voter }

    orob2b_product_viisbility.acl.voter.account:
        class: %orob2b_account.acl.voter.product_visibility.class%
        arguments:
            - @oro_entity.doctrine_helper
        calls:
            - [setClassName, [%orob2b_product.product.class%]]
            - [setModifier, [@orob2b_account.model.product_visibility_query_builder_modifier]]
        tags:
            - { name: security.voter }

    orob2b_account.event_listener.datagrid.account:
        class: %orob2b_account.event_listener.datagrid.account.class%
        arguments:
            - @orob2b_account.security.account_user_provider
            - [@orob2b_account.datagrid.account_action_permission_provider, "getActions"]
        tags:
            - { name: kernel.event_listener, event: oro_datagrid.datagrid.build.before, method: onBuildBeforeFrontendItems }

    orob2b_account.account_tree_handler:
        class: %orob2b_account.account_tree_handler.class%
        arguments:
            - %orob2b_account.entity.account.class%
            - @doctrine

    orob2b_account.manager.account.api.attribute:
        class:  %orob2b_account.manager.api.attribute.class%
        parent: oro_soap.manager.entity_manager.abstract
        arguments:
            - %orob2b_account.entity.account.class%
            - @doctrine.orm.entity_manager

    orob2b_account.manager.group.api.attribute:
        class:  %orob2b_account.manager.api.attribute.class%
        parent: oro_soap.manager.entity_manager.abstract
        arguments:
            - %orob2b_account.entity.account_group.class%
            - @doctrine.orm.entity_manager

    orob2b_account.form.autocomplete.account_group.search_handler:
        parent: oro_form.autocomplete.search_handler
        arguments:
            - %orob2b_account.entity.account_group.class%
            - ["name"]
        tags:
            - { name: oro_form.autocomplete.search_handler, alias: orob2b_account_group, acl_resource: orob2b_account_group_view }
        lazy: true

    orob2b_account.form.autocomplete.account.search_handler:
        parent: oro_form.autocomplete.search_handler
        arguments:
            - %orob2b_account.entity.account.class%
            - ["name"]
        tags:
            - { name: oro_form.autocomplete.search_handler, alias: orob2b_account, acl_resource: orob2b_account_view }
        lazy: true

    orob2b_account.form.autocomplete.account_parent.search_handler:
        parent: oro_form.autocomplete.search_handler
        class: %orob2b_account.form.autocomplete.parent_account.search_handler.class%
        arguments:
            - %orob2b_account.entity.account.class%
            - ["name"]
        tags:
            - { name: oro_form.autocomplete.search_handler, alias: orob2b_account_parent, acl_resource: orob2b_account_view }
        lazy: true

    orob2b_account.form.autocomplete.account_user_account.search_handler:
        parent: oro_form.autocomplete.search_handler
        class: %orob2b_account.form.autocomplete.account_account_user.search_handler.class%
        arguments:
            - %orob2b_account.entity.account_user.class%
            - ["firstname", "lastname"]
        tags:
            - { name: oro_form.autocomplete.search_handler, alias: orob2b_account_account_user, acl_resource: orob2b_account_account_user_view }
        lazy: true

    orob2b_account.account_user.manager.api:
        class: %orob2b_account.account_user.manager.api.class%
        parent: oro_soap.manager.entity_manager.abstract
        arguments:
            - %orob2b_account.entity.account_user.class%
            - @doctrine.orm.entity_manager

    orob2b_account.account_user_role.manager.api:
        class: %orob2b_account.account_user.manager.api.class%
        parent: oro_soap.manager.entity_manager.abstract
        arguments:
            - %orob2b_account.entity.account_user_role.class%
            - @doctrine.orm.entity_manager

    orob2b_account.datagrid.action_permission_provider:
        class: %orob2b_account.datagrid.action_permission_provider.class%
        arguments:
            - @oro_security.security_facade

    orob2b_account.datagrid.account_action_permission_provider:
        class: %orob2b_account.datagrid.account_action_permission_provider.class%
        arguments:
            - @oro_security.security_facade
            - @doctrine

    orob2b_account.datagrid.extension.accoun_user:
        class: %orob2b_account.datagrid.extension.accoun_user.class%
        calls:
            - [setContainer, [@service_container]]
        tags:
            - { name: oro_datagrid.extension }

    orob2b_account.datagrid.extension.accoun_user_by_account:
        class: %orob2b_account.datagrid.extension.accoun_user_by_account.class%
        calls:
            - [setRequestStack, [@request_stack]]
        tags:
            - { name: oro_datagrid.extension }

    orob2b_account.mailer.processor:
        class: %orob2b_account.mailer.processor.class%
        arguments:
            - @doctrine
            - @oro_config.global
            - @oro_email.email_renderer
            - @oro_email.email_holder_helper
            - @oro_email.direct_mailer

    orob2b_account_user.manager:
        class: %orob2b_account_user.manager.class%
        arguments:
            - %orob2b_account.entity.account_user.class%
            - @doctrine
            - @security.encoder_factory
        calls:
            - [setContainer, [@service_container]]

    orob2b_user.security.provider:
        class: %oro_user.security.provider.class%
        public: false
        arguments:
            - @orob2b_account_user.manager

    orob2b_account_user.security.provider:
        class: %oro_user.security.provider.class%
        public: false
        arguments:
            - @orob2b_account_user.manager

    orob2b_account.account_user_menu:
        class: %orob2b_account.account_user_menu.builder.class%
        tags:
            - { name: oro_menu.builder, alias: account_usermenu }

    orob2b_account.placeholder.filter:
        class: %orob2b_account.placeholder.filter.class%
        arguments:
            - @oro_security.security_facade

    orob2b_account.account_user.password.handler.abstract:
        class: %orob2b_account.account_user.password.handler.abstract.class%
        abstract: true
        arguments:
            - @orob2b_account_user.manager
            - @translator

    orob2b_account.account_user.password_request.handler:
        class: %orob2b_account.account_user.password_request.handler.class%
        parent: orob2b_account.account_user.password.handler.abstract

    orob2b_account.account_user.password_reset.handler:
        class: %orob2b_account.account_user.password_reset.handler.class%
        parent: orob2b_account.account_user.password.handler.abstract

    orob2b_account.event_listener.datagrid.website:
        class: %orob2b_account.event_listener.datagrid.website.class%
        tags:
            - { name: kernel.event_listener, event: oro_datagrid.datagrid.build.before.websites-grid, method: onBuildBeforeWebsites }

    orob2b_account.event_listener.form_view:
        class: %orob2b_account.form.event_listener.form_view.class%
        arguments:
            - @translator
            - @oro_entity.doctrine_helper
            - @request_stack
        tags:
            - { name: kernel.event_listener, event: oro_ui.scroll_data.before.category-edit, method: onCategoryEdit }

    orob2b_account.acl.voter.account_user_role:
        class: %orob2b_account.acl.voter.account_user_role.class%
        arguments:
            - @oro_entity.doctrine_helper
        calls:
            - [setContainer, [@service_container]]
            - [setClassName, [%orob2b_account.entity.account_user_role.class%]]
        tags:
            - { name: security.voter, priority: 10 }

    orob2b_account.account_address.manager.api:
        class: %orob2b_account.account_address.manager.api.class%
        parent: oro_soap.manager.entity_manager.abstract
        arguments:
            - %orob2b_account.entity.account_address.class%
            - @doctrine.orm.entity_manager

    orob2b_account.event_listener.login:
        class: %orob2b_account.event_listener.login.class%
        tags:
            - { name: kernel.event_listener, event: security.interactive_login, method: onSecurityInteractiveLogin }

    orob2b_account.acl.group_provider:
        class: %orob2b_account.acl.group_provider.class%
        calls:
            - [setContainer, [@service_container]]
        tags:
            - { name: oro_security.acl.group_provider, alias: frontend_group }

    orob2b_account.acl.resolver.role_translation_prefix:
        class: %orob2b_account.acl.resolver.role_translation_prefix.class%
        arguments:
            - @oro_security.security_facade

    orob2b_account.account_user_address.manager.api:
        class: %orob2b_account.account_user_address.manager.api.class%
        parent: oro_soap.manager.entity_manager.abstract
        arguments:
            - %orob2b_account.entity.account_user_address.class%
            - @doctrine.orm.entity_manager

    orob2b_account.event_listener.datagrid.account_user_role:
        class: %orob2b_account.event_listener.datagrid.account_user_role.class%
        arguments:
            - @oro_security.security_facade
        tags:
            - { name: kernel.event_listener, event: oro_datagrid.datagrid.build.before.frontend-account-account-user-roles-grid, method: onBuildBefore }

    orob2b_account.event_listener.datagrid.account_user:
        class: %orob2b_account.event_listener.datagrid.account_user.class%
        tags:
            - { name: kernel.event_listener, event: oro_datagrid.datagrid.build.pre.account-account-users-grid-update-basic, method: onBuildBefore }

    orob2b_account.twig.security_extension:
        class: %orob2b_account.twig.account_extension.class%
        arguments:
            - @orob2b_account.security.account_user_provider
        tags:
            - { name: twig.extension }

    orob2b_account.event_listener.system_config:
        class: %orob2b_account.event_listener.system_config.class%
        arguments:
            - @doctrine
            - %oro_user.entity.class%
        tags:
            - { name: kernel.event_listener, event: oro_config.settings_form_preset, method: onFormPreSetData }
            - { name: kernel.event_listener, event: oro_config.settings_before_save, method: onSettingsSaveBefore }

    orob2b_frontend.listener.ormdatasource_acl:
        class: %orob2b_account.event_listener.ormdatasource_acl.class%
        arguments:
            - @oro_security.security_facade
            - @orob2b_account.owner.frontend_ownership_metadata_provider
        tags:
            - { name: kernel.event_listener, event: oro_datagrid.orm_datasource.result.before, method: onResultBefore, priority: 100 }

    orob2b_account.item.builder.pinbar:
        class: %orob2b_account.item.builder.pinbar.class%
        arguments:
            - @doctrine.orm.entity_manager
        calls:
            - [ setClassName, [ %orob2b_account.entity.pinbar_tab.class% ]]
            - [ setNavigationItemClassName, [ %orob2b_account.entity.navigation_item.class% ]]
        tags:
            - { name: oro_navigation.item.builder, alias: frontend_pinbar }

    orob2b_account.item.builder.favorite:
        class: %orob2b_account.item.builder.favorite.class%
        arguments:
            - @doctrine.orm.entity_manager
        calls:
            - [ setClassName, [ %orob2b_account.entity.navigation_item.class% ]]
        tags:
            - { name: oro_navigation.item.builder, alias: frontend_favorite }

    orob2b_account.pinbar_menu.builder:
        class: %orob2b_account.navigation_item_menu.builder.class%
        arguments:
            - @security.context
            - @doctrine.orm.entity_manager
            - @oro_navigation.item.factory
        tags:
            - { name: oro_menu.builder, alias: frontend_pinbar }

    orob2b_account.favorites_menu.builder:
        class: %orob2b_account.navigation_item_menu.builder.class%
        arguments:
            - @security.context
            - @doctrine.orm.entity_manager
            - @oro_navigation.item.factory
        tags:
            - { name: oro_menu.builder, alias: frontend_favorite }

    orob2b_account.history_menu.builder:
        class: %orob2b_account.history_menu.builder.class%
        arguments:
            - @security.context
            - @doctrine.orm.entity_manager
            - @oro_navigation.item.factory
        calls:
            - [ setMatcher, [ @knp_menu.matcher ]]
            - [ setOptions, [ @oro_config.user ]]
        tags:
            - { name: oro_menu.builder, alias: frontend_history }

    orob2b_account.mostviewed_menu.builder:
        class: %orob2b_account.navigation_mostviewed_menu.builder.class%
        arguments:
            - @security.context
            - @doctrine.orm.entity_manager
            - @oro_navigation.item.factory
        calls:
            - [ setOptions, [ @oro_config.user ]]
        tags:
            - { name: oro_menu.builder, alias: frontend_mostviewed }

    orob2b_account.item.pinbar.post_persist_listener:
        class: %orob2b_account.item.pinbar.post_persist_listener.class%
        calls:
            - [ setClassName, [ %orob2b_account.entity.pinbar_tab.class% ]]
        tags:
            - { name: doctrine.event_listener, event: postPersist }

    kernel.listener.frontend_nav_history_response:
        class: %oro_navigation.event.response_history.listener.class%
        tags:
            - { name: kernel.event_listener, event: kernel.response, method: onResponse }
        arguments:
            - @oro_navigation.item.factory
            - @security.context
            - @doctrine
            - @oro_navigation.title_service
        calls:
            - [ setHistoryItemEntityFQCN, [ %orob2b_account.entity.navigation_history_item.class% ]]
            - [ setUserEntityFQCN, [ %orob2b_account.entity.account_user.class%]]
            - [ setNavigationHistoryItemType, ['frontend_history']]

    orob2b_account.item.builder.history:
        class: %orob2b_account.item.builder.history.class%
        arguments:
            - @doctrine.orm.entity_manager
        calls:
            - [ setClassName, [ %orob2b_account.entity.navigation_history_item.class% ]]
        tags:
            - { name: oro_navigation.item.builder, alias: frontend_history }

    orob2b_account.item.builder.mostviewed:
        class: %orob2b_account.item.builder.history.class%
        arguments:
            - @doctrine.orm.entity_manager
        calls:
            - [ setClassName, [ %orob2b_account.entity.navigation_history_item.class% ]]
        tags:
            - { name: oro_navigation.item.builder, alias: frontend_mostviewed }

    orob2b_account.content_provider.menu.history_menu:
        class: %orob2b_account.content_provider.menu.class%
        arguments:
            - @oro_menu.twig.extension
            - "frontend_history"
            - "frontend_history"
        tags:
            - { name: oro_ui.content_provider }

    orob2b_account.content_provider.menu.mostviewed_menu:
        class: %orob2b_account.content_provider.menu.class%
        arguments:
            - @oro_menu.twig.extension
            - "frontend_mostviewed"
            - "frontend_mostviewed"
        tags:
            - { name: oro_ui.content_provider }

    orob2b_account.event_listener.visibility_grid_listener:
        class: %orob2b_account.event_listener.visibility_grid_listener.class%
        arguments:
            - @doctrine
            - @orob2b_account.provider.visibility_choices
        calls:
            - [ addSubscribedGridConfig, { datagrid: account-group-category-visibility-grid, visibilityEntityClass: %orob2b_account.entity.account_group_category_visibility.class%, targetEntityClass: %orob2b_catalog.category.class% }]
            - [ addSubscribedGridConfig, { datagrid: account-category-visibility-grid, visibilityEntityClass: %orob2b_account.entity.account_category_visibility.class%, targetEntityClass: %orob2b_catalog.category.class% }]
            - [ addSubscribedGridConfig, { datagrid: account-group-product-visibility-grid, visibilityEntityClass: %orob2b_account.entity.account_group_product_visibility.class%, targetEntityClass: %orob2b_product.product.class% }]
            - [ addSubscribedGridConfig, { datagrid: account-product-visibility-grid, visibilityEntityClass: %orob2b_account.entity.account_product_visibility.class%, targetEntityClass: %orob2b_product.product.class% }]
        tags:
            - { name: kernel.event_listener, event: oro_datagrid.datagrid.build.pre.account-category-visibility-grid, method: onPreBuild }
            - { name: kernel.event_listener, event: oro_datagrid.datagrid.build.pre.account-group-category-visibility-grid, method: onPreBuild }
            - { name: kernel.event_listener, event: oro_datagrid.orm_datasource.result.before.account-category-visibility-grid, method: onResultBefore }
            - { name: kernel.event_listener, event: oro_datagrid.orm_datasource.result.before.account-group-category-visibility-grid, method: onResultBefore }
            - { name: kernel.event_listener, event: oro_datagrid.datagrid.build.pre.account-product-visibility-grid, method: onPreBuild }
            - { name: kernel.event_listener, event: oro_datagrid.datagrid.build.pre.account-group-product-visibility-grid, method: onPreBuild }
            - { name: kernel.event_listener, event: oro_datagrid.orm_datasource.result.before.account-product-visibility-grid, method: onResultBefore }
            - { name: kernel.event_listener, event: oro_datagrid.orm_datasource.result.before.account-group-product-visibility-grid, method: onResultBefore }

    orob2b_account.event_listener.product_duplicate_listener:
        class: %orob2b_account.event_listener.product_duplicate_listener.class%
        arguments:
            - @doctrine
        tags:
            - { name: kernel.event_listener, event: orob2b_product.product.duplicate.after, method: onDuplicateProduct }
        calls:
            - [ setVisibilityToAllClassName, [ %orob2b_account.entity.product_visibility.class% ] ]
            - [ setVisibilityAccountGroupClassName, [ %orob2b_account.entity.account_group_product_visibility.class% ] ]
            - [ setVisibilityAccountClassName, [ %orob2b_account.entity.account_product_visibility.class% ] ]
            - [ setFieldName, ['product'] ]

    orob2b_account.event_listener.default_visibility:
        class: %orob2b_account.event_listener.default_visibility.class%
        tags:
            - { name: doctrine.event_listener, event: onFlush }

    orob2b_account.form.event_listener.category_visibility_post_submit:
        class: %orob2b_account.form.event_listener.category_visibility_post_submit.class%
        parent: orob2b_account.form.event_listener.abstract_visibility_post_submit
        tags:
            - { name: kernel.event_listener, event: orob2b_catalog.category.edit, method: onPostSubmit }

    orob2b_account.form.event_listener.product_visibility_post_submit:
        class: %orob2b_account.form.event_listener.product_visibility_post_submit.class%
        parent: orob2b_account.form.event_listener.abstract_visibility_post_submit
        tags:
            - { name: kernel.event_listener, event: orob2b_product.product.edit, method: onPostSubmit }

    orob2b_account.account_delete_handler:
        class: %orob2b_account.account_delete_handler.class%
        arguments:
            - @oro_security.security_facade

    orob2b.account.catalog.visibility.change_set.validatior:
        class: %orob2b.account.catalog.visibility.change_set.validatior.class%
        tags:
            - { name: validator.constraint_validator, alias: orob2b.account.catalog.visibility.change_set.validatior }

    orob2b_account.provider.visibility_choices:
        class: %orob2b_account.provider.visibility_choices.class%
        arguments:
            - @translator
            - @doctrine

    orob2b_account.audit.discriminator_map_listener:
        class: %orob2b_account.audit.discriminator_map_listener.class%
        calls:
            - [ addClass, [ orob2b_audit, %orob2b_account.entity.audit.class% ] ]
        tags:
            - { name: doctrine.event_listener, event: loadClassMetadata }

    orob2b_account.helper.account_user_role_privileges:
        class: %orob2b_account.helper.account_user_role_privileges.class%
        arguments:
            - @orob2b_account.form.handler.update_account_user_role=

    orob2b_account.helper.account_user_role_privileges.frontend:
        class: %orob2b_account.helper.account_user_role_privileges.class%
        arguments:
            - @orob2b_account.form.handler.update_account_user_role_frontend=

    orob2b_account.visibility.resolver.category_visibility_resolver:
        class: %orob2b_account.visibility.resolver.category_visibility_resolver.class%
        arguments:
            - @doctrine
            - @oro_config.manager

    orob2b_account.event_listener.category_tree_handler_listener:
        class: %orob2b_account.event_listener.category_tree_handler_listener.class%
        arguments:
            - @orob2b_account.visibility.resolver.category_visibility_resolver
        tags:
            - {name: kernel.event_listener, event: orob2b_catalog.category.tree.create_after, method: onCreateAfter }

    orob2b_account.event_listener.frontend_dataaudit_history_grid_listener:
        class:  %oro_dataaudit.event_listener.dataaudit_history_grid_listener.class%
        arguments:
            - [objectClass, objectId]
        tags:
          - { name: kernel.event_listener, event: oro_datagrid.datagrid.build.after.frontend-audit-history-grid, method: onBuildAfter }

    orob2b_account.model.product_visibility_query_builder_modifier:
        class: %orob2b_account.model.product_visibility_query_builder_modifier.class%
        arguments:
            - @oro_config.global
            - @security.token_storage
            - @orob2b_website.manager
        calls:
            - [setProductVisibilitySystemConfigurationPath, ['oro_b2b_account.product_visibility']]
            - [setCategoryVisibilitySystemConfigurationPath, ['oro_b2b_account.category_visibility']]

    orob2b_account.visibility.cache.product.cache_builder.abstract:
        class: %orob2b_account.visibility.cache.product.cache_builder.abstract.class%
        abstract: true
        arguments:
            - @doctrine
            - @oro_entity.orm.insert_from_select_query_executor

    orob2b_account.visibility.cache.product.account_group_product_resolved_cache_builder:
        class: %orob2b_account.visibility.cache.product.account_group_product_resolved_cache_builder.class%
        parent: orob2b_account.visibility.cache.product.cache_builder.abstract
        calls:
            - [setCacheClass, [%orob2b_account.entity.account_group_product_visibility_resolved.class%]]

    orob2b_account.visibility.cache.product.account_product_resolved_cache_builder:
        class: %orob2b_account.visibility.cache.product.account_product_resolved_cache_builder.class%
        parent: orob2b_account.visibility.cache.product.cache_builder.abstract
        calls:
            - [setCacheClass, [%orob2b_account.entity.account_product_visibility_resolved.class%]]

    orob2b_account.visibility.cache.product.product_resolved_cache_builder:
        class: %orob2b_account.visibility.cache.product.product_resolved_cache_builder.class%
        parent: orob2b_account.visibility.cache.product.cache_builder.abstract
        calls:
            - [setCacheClass, [%orob2b_account.entity.product_visibility_resolved.class%]]

    orob2b_account.visibility.cache.product.cache_builder:
        class: %orob2b_account.visibility.cache.product.cache_builder.class%
        calls:
            - [addBuilder, [@orob2b_account.visibility.cache.product.product_resolved_cache_builder]]
            - [addBuilder, [@orob2b_account.visibility.cache.product.account_group_product_resolved_cache_builder]]
            - [addBuilder, [@orob2b_account.visibility.cache.product.account_product_resolved_cache_builder]]

    orob2b_account.visibility.cache.product.category.account_group_category_resolved_cache_builder:
        class: %orob2b_account.visibility.cache.product.category.account_group_category_resolved_cache_builder.class%
        parent: orob2b_account.visibility.cache.product.cache_builder.abstract
        calls:
            - [setCacheClass, [%orob2b_account.entity.account_group_category_visibility_resolved.class%]]
            - [setVisibilityChangeAccountSubtreeCacheBuilder, [@orob2b_account.visibility.cache.product.category.subtree.visibility_change_group_subtree_cache_builder]]

    orob2b_account.visibility.cache.product.category.account_category_resolved_cache_builder:
        class: %orob2b_account.visibility.cache.product.category.account_category_resolved_cache_builder.class%
        parent: orob2b_account.visibility.cache.product.cache_builder.abstract
        calls:
            - [setCacheClass, [%orob2b_account.entity.account_category_visibility_resolved.class%]]
            - [setVisibilityChangeAccountSubtreeCacheBuilder, [@orob2b_account.visibility.cache.product.category.subtree.visibility_change_account_subtree_cache_builder]]

    orob2b_account.visibility.cache.product.category.category_resolved_cache_builder:
        class: %orob2b_account.visibility.cache.product.category.category_resolved_cache_builder.class%
        parent: orob2b_account.visibility.cache.product.cache_builder.abstract
        calls:
            - [setCacheClass, [%orob2b_account.entity.category_visibility_resolved.class%]]
            - [setVisibilityChangeCategorySubtreeCacheBuilder, [@orob2b_account.visibility.cache.product.category.subtree.visibility_change_category_subtree_cache_builder]]
            - [setPositionChangeCategorySubtreeCacheBuilder, [@orob2b_account.visibility.cache.product.category.subtree.position_change_category_subtree_cache_builder]]

    orob2b_account.visibility.cache.product.category.cache_builder:
        class: %orob2b_account.visibility.cache.product.category.cache_builder.class%
        calls:
            - [addBuilder, [@orob2b_account.visibility.cache.product.category.category_resolved_cache_builder]]
            - [addBuilder, [@orob2b_account.visibility.cache.product.category.account_group_category_resolved_cache_builder]]
            - [addBuilder, [@orob2b_account.visibility.cache.product.category.account_category_resolved_cache_builder]]

    orob2b_account.visibility.cache.cache_builder:
        class: %orob2b_account.visibility.cache.cache_builder.class%
        calls:
            - [addBuilder, [@orob2b_account.visibility.cache.product.category.cache_builder]]
            - [addBuilder, [@orob2b_account.visibility.cache.product.cache_builder]]

    orob2b_account.visibility.cache.product.category.subtree.category_subtree_cache_builder:
        class: %orob2b_account.visibility.cache.product.category.subtree.category_subtree_cache_builder.class%
        abstract: true
        arguments:
            - @doctrine
            - @orob2b_account.visibility.resolver.category_visibility_resolver
            - @oro_config.manager

    orob2b_account.visibility.cache.product.category.subtree.visibility_change_category_subtree_cache_builder:
        class: %orob2b_account.visibility.cache.product.category.subtree.visibility_change_category_subtree_cache_builder.class%
        parent: orob2b_account.visibility.cache.product.category.subtree.category_subtree_cache_builder

    orob2b_account.visibility.cache.product.category.subtree.position_change_category_subtree_cache_builder:
        class: %orob2b_account.visibility.cache.product.category.subtree.position_change_category_subtree_cache_builder.class%
        parent: orob2b_account.visibility.cache.product.category.subtree.category_subtree_cache_builder

    orob2b_account.visibility.cache.product.category.subtree.visibility_change_account_subtree_cache_builder:
        class: %orob2b_account.visibility.cache.product.category.subtree.visibility_change_account_subtree_cache_builder.class%
        parent: orob2b_account.visibility.cache.product.category.subtree.category_subtree_cache_builder

    orob2b_account.visibility.cache.product.category.subtree.visibility_change_group_subtree_cache_builder:
        class: %orob2b_account.visibility.cache.product.category.subtree.visibility_change_group_subtree_cache_builder.class%
        parent: orob2b_account.visibility.cache.product.category.subtree.category_subtree_cache_builder

    orob2b_account.event_listener.product_select_db_query:
        class: %orob2b_account.event_listener.product_select_db_query.class%
        arguments:
            - @orob2b_frontend.request.frontend_helper
            - @orob2b_account.model.product_visibility_query_builder_modifier
        tags:
            - { name: kernel.event_listener, event: orob2b_product.product_select.db.query, method: onDBQuery }

    # Actions
    orob2b_account.model.action.abstract_entity_aware_action:
        class: %orob2b_account.model.action.abstract_entity_aware_action.class%
        abstract: true
        arguments:
            - @oro_action.context_accessor

    orob2b_account.model.action.abstract_visibility_action:
        parent: orob2b_account.model.action.abstract_entity_aware_action
        class: %orob2b_account.model.action.abstract_visibility_action.class%
        abstract: true

    orob2b_account.model.action.abstract_visibility_registry_aware_action:
        parent: orob2b_account.model.action.abstract_visibility_action
        class: %orob2b_account.model.action.abstract_visibility_registry_aware_action.class%
        abstract: true
        calls:
            - [setRegistry, [@doctrine]]

    orob2b_account.model.action.change_category_visibility:
        class: %orob2b_account.model.action.change_category_visibility.class%
        parent: orob2b_account.model.action.abstract_visibility_registry_aware_action
        calls:
            - [setCacheBuilder, [@orob2b_account.visibility.cache.product.category.cache_builder]]
        tags:
            - { name: oro_workflow.action, alias: change_category_visibility }

    orob2b_account.model.action.change_category_position:
        class: %orob2b_account.model.action.change_category_position.class%
        parent: orob2b_account.model.action.abstract_visibility_registry_aware_action
        calls:
            - [setCacheBuilder, [@orob2b_account.visibility.cache.product.category.cache_builder]]
        tags:
            - { name: oro_workflow.action, alias: change_category_position }

    orob2b_account.model.action.resolve_product_visibility:
        parent: orob2b_account.model.action.abstract_visibility_registry_aware_action
        class: %orob2b_account.model.action.resolve_product_visibility.class%
        calls:
            - [setCacheBuilder, [@orob2b_account.visibility.cache.product.cache_builder]]
        tags:
            - { name: oro_workflow.action, alias: resolve_product_visibility }

    orob2b_account.model.action.change_product_category:
        parent: orob2b_account.model.action.abstract_visibility_registry_aware_action
        class: %orob2b_account.model.action.change_product_category.class%
        calls:
            - [setCacheBuilder, [@orob2b_account.visibility.cache.product.cache_builder]]
        tags:
            - { name: oro_workflow.action, alias: change_product_category }

    orob2b_account.model.action.build_website_cache:
        parent: orob2b_account.model.action.abstract_visibility_registry_aware_action
        class: %orob2b_account.model.action.build_website_cache.class%
        calls:
            - [setCacheBuilder, [@orob2b_account.visibility.cache.product.cache_builder]]
        tags:
            - { name: oro_workflow.action, alias: build_website_cache }

    orob2b_account.event_listener.category_listener:
        arguments:
            - @doctrine
            - @oro_entity.orm.insert_from_select_query_executor
            - @orob2b_account.visibility.cache.product.cache_builder
        class: %orob2b_account.event_listener.category_listener.class%
        tags:
            - { name: doctrine.event_listener, event: onFlush }
            - { name: doctrine.event_listener, event: postFlush }
            - { name: doctrine.event_listener, event: postRemove }

    orob2b_account.provider.frontend_account_user_registration_form:
        class: %orob2b_account.provider.frontend_account_user_registration_form.class%
        arguments:
            - @form.factory
            - @doctrine
            - @oro_config.manager
            - @orob2b_website.manager
            - @oro_user.manager
        tags:
            - { name: layout.data_provider, alias: orob2b_account_frontend_account_user_register }

    orob2b_account.manager.windows_state:
        parent: oro_windows.manager.windows_state.abstract
        arguments:
            - %orob2b_account.entity.windows_state.class%
            - %orob2b_account.entity.account_user.class%

    orob2b_account.provider.sign_in:
        class: %orob2b_account.provider.sign_in.class%
        arguments:
            - @request_stack
            - @oro_security.security_facade
            - @security.csrf.token_manager
        tags:
            - { name: layout.data_provider, alias: orob2b_account_sign_in }

    orob2b_account.doctrine.filters_listener:
        class: %orob2b_account.doctrine.filters_listener.class%
        arguments:
            - @doctrine
            - @orob2b_frontend.request.frontend_helper
        tags:
            - { name: kernel.event_listener, event: kernel.request, method: onRequest }

    orob2b_account.provider.frontend_account_user_role_privileges:
        class: %orob2b_account.provider.frontend_account_user_role_privileges.class%
        arguments:
            - @orob2b_account.helper.account_user_role_privileges.frontend
        tags:
            - { name: layout.data_provider, alias: orob2b_account_frontend_account_user_role_privileges }

    orob2b_account.provider.frontend_account_user_role_form:
        class: %orob2b_account.provider.frontend_account_user_role_form.class%
        arguments:
            - @orob2b_account.form.handler.update_account_user_role_frontend=
        tags:
            - { name: layout.data_provider, alias: orob2b_account_frontend_account_user_role_form }
